<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Distributed Transactions from the .NET SDK | Couchbase Docs</title>
<link rel="canonical" href="https://docs.couchbase.com/dotnet-sdk/current/howtos/distributed-acid-transactions-from-the-sdk.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="A practical guide to using Couchbase&#x27;s distributed ACID transactions, via the .NET SDK.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
        <link rel="prev" href="view-queries-with-sdk.html">
        <link rel="next" href="transactions-single-query.html">
<meta name="dcterms.subject" content="dotnet-sdk">
<meta name="dcterms.identifier" content="3.3">
<meta name="page-url" content="/dotnet-sdk/current/howtos/distributed-acid-transactions-from-the-sdk.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a href="https://cloud.couchbase.com/sign-up" class="free-trial-link" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  <i class="fas fa-cloud"></i>
                  Free Trial
                </a>
                <a class="btn btn-primary try-btn"  onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
<div class="components">
  <div class="components_group-title">
    <a href="../../../home/sdk.html">SDKs</a>
  </div>
  <ul class="components_list">
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">.NET SDK</span>
        <select class="version_list" data-component="dotnet-sdk">
          <option value="3.3" data-url="../hello-world/overview.html" selected>3.3</option>
        </select>
      </div>
      <div class="version_items hide" data-version="3.3">
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Getting Started</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../hello-world/start-using-sdk.html">Start Using the .NET SDK</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../hello-world/platform-help.html">Platform Introduction</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../hello-world/sample-application.html">Sample Application</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Working with Data</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="kv-operations.html">Key Value Operations</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="subdocument-operations.html">Sub-Document Operations</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="n1ql-queries-with-sdk.html">Query</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="analytics-using-sdk.html">Analytics</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="full-text-searching-with-sdk.html">Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="view-queries-with-sdk.html">MapReduce Views</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Transactions</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-current-page is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link is-current-page" href="distributed-acid-transactions-from-the-sdk.html">How-to Guide</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="transactions-single-query.html">Single Query Transactions</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../concept-docs/transactions.html">Key Concepts</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/transactions-cleanup.html">Cleanup</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/transactions-error-handling.html">Error Handling</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Advanced Data Operations</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concurrent-async-apis.html">Async &amp; React APIs</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concurrent-document-mutations.html">Concurrent Document Mutations</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="encrypting-using-sdk.html">Encrypting Your Data</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="transcoders-nonjson.html">Transcoders &amp; Non-JSON</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="working-with-collections.html">Working with Collections</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Managing Couchbase</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="managing-connections.html">Managing Connections</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sdk-authentication.html">Authentication</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="troubleshooting-cloud-connections.html">Troubleshooting Cloud Connections</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="provisioning-cluster-resources.html">Provisioning Cluster Resources</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sdk-user-management-example.html">User Management</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Errors &amp; Diagnostics</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="error-handling.html">Handling Errors</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="collecting-information-and-logging.html">Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="health-check.html">Health Check</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Observability</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="slow-operations-logging.html">Slow Operations Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="observability-metrics.html">Metrics Reporting</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="observability-orphan-logger.html">Orphan Requests Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="observability-tracing.html">Request Tracing</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Learn</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/concepts.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/buckets-and-clusters.html">Buckets &amp; Clusters</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/collections.html">Collections &amp; Scope</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/compression.html">Compression</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../concept-docs/data-model.html">Data Model</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/documents.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/nonjson.html">Non-json Docs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/subdocument-operations.html">Sub-Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/xattr.html">XATTR &amp; Virtual XATTR</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../concept-docs/errors.html">Errors and Diagnostics</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/health-check.html">Health Check</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/response-time-observability.html">Tracing</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/durability-replication-failure-considerations.html">Failure Considerations</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/encryption.html">Field Level Encryption</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../concept-docs/data-services.html">Service Selection</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/analytics-for-sdk-users.html">Analytics</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/understanding-views.html">Map Reduce Views</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/n1ql-query.html">Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/full-text-search-overview.html">Search</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../concept-docs/sdk-user-management-overview.html">User Management</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/certificate-based-authentication.html">Cert Auth</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../concept-docs/rbac.html">RBAC</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">References</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/sdk-api/couchbase-net-client">.NET API Reference</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/sdk-api/couchbase-transactions-dotnet/">Txns API Reference</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../ref/client-settings.html">Client Settings</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../ref/error-codes.html">Error Messages</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../ref/glossary.html">Glossary</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../ref/travel-app-data-model.html">Travel Sample Data Model</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Project Docs</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../project-docs/sdk-release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../project-docs/distributed-transactions-dotnet-release-notes.html">Transactions Release Notes</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../project-docs/compatibility.html">Compatibility</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../project-docs/migrating-sdk-code-to-3.n.html">Migrating to SDK 3 API</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../project-docs/sdk-full-installation.html">Full Installation</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../project-docs/performance.html">Best Practices</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs-archive.couchbase.com/home/index.html">Older Versions Archive</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../project-docs/sdk-licenses.html">Licenses</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../project-docs/get-involved.html">Get involved</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/home/contribute/index.html">Improve the Docs</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../project-docs/metadoc-about-these-sdk-docs.html">About These Docs</a>
  </span>
</li>
</ul>
</li>
</ul>
      </div>
    </li>
  </ul>
</div>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="2">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/pages/distributed-acid-transactions-from-the-sdk.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../hello-world/overview.html">.NET SDK</a></li>
<li class="crumb">Transactions</li>
<li class="crumb"><a href="distributed-acid-transactions-from-the-sdk.html">How-to Guide</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Distributed Transactions from the .NET SDK</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
A practical guide to using Couchbase&#8217;s distributed ACID transactions, via the .NET SDK.
</blockquote>
</div>
<div class="paragraph">
<p>This guide will show you examples of how to perform multi-document ACID (atomic, consistent, isolated, and durable) database transactions within your application, using the Couchbase .NET SDK and transactions library.</p>
</div>
<div class="paragraph">
<p>Refer to the <a href="../concept-docs/transactions.html" class="xref page">Distributed ACID Transactions</a> concept material for a high-level overview.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_couchbase-capella"></a>Couchbase Capella</p>
</li>
<li>
<p><a id="tabset1_couchbase-server"></a>Couchbase Server</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_couchbase-capella">
<div class="ulist">
<ul>
<li>
<p>Couchbase Capella account.</p>
</li>
<li>
<p>You should know how to perform <a href="kv-operations.html" class="xref page">key-value</a> or <a href="n1ql-queries-with-sdk.html" class="xref page">query</a> operations with the SDK.</p>
</li>
<li>
<p>Your application should have the relevant roles and permissions on the required buckets, scopes, and collections, to perform transactional operations.
Refer to the <a href="#cloud:organizations:organization-projects-overview.adoc" class="xref unresolved">Organizations &amp; Access</a> page for more details.</p>
</li>
<li>
<p>If your application is using <a href="../concept-docs/xattr.html" class="xref page">extended attributes (XATTRs)</a>, you should avoid using the XATTR field <code>txn</code>&#8201;&#8212;&#8201;this is reserved for Couchbase use.</p>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_couchbase-server">
<div class="ulist">
<ul>
<li>
<p>Couchbase Server (6.6.2 or above).</p>
</li>
<li>
<p>You should know how to perform <a href="kv-operations.html" class="xref page">key-value</a> or <a href="n1ql-queries-with-sdk.html" class="xref page">query</a> operations with the SDK.</p>
</li>
<li>
<p>Your application should have the relevant roles and permissions on the required buckets, scopes, and collections, to perform transactional operations.
Refer to the <a href="../../../server/current/learn/security/roles.html" class="xref page">Roles</a> page for more details.</p>
</li>
<li>
<p>If your application is using <a href="../concept-docs/xattr.html" class="xref page">extended attributes (XATTRs)</a>, you should avoid using the XATTR field <code>txn</code>&#8201;&#8212;&#8201;this is reserved for Couchbase use.</p>
</li>
<li>
<p>NTP should be configured so nodes of the Couchbase cluster are in sync with time.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>NTP should be configured so nodes of the Couchbase cluster are in sync with time.</p>
</li>
<li>
<p>The application, if it is using <a href="../concept-docs/xattr.html" class="xref page">extended attributes (XATTRs)</a>, must avoid using the XATTR field <code>txn</code>, which is reserved for Couchbase use.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If using a single node cluster (for example, during development), then note that the default number of replicas for a newly created bucket is 1.
If left at this default, then all Key-Value writes performed at with durability will fail with a <code>DurabilityImpossibleException</code>.
In turn this will cause all transactions (which perform all Key-Value writes durably) to fail.
This setting can be changed via <a href="../../../server/current/manage/manage-buckets/create-bucket.html#couchbase-bucket-settings" class="xref page">GUI</a> or <a href="#7.1@server:cli:cbcli/couchbase-cli-bucket-create.adoc#options" class="xref unresolved">command line</a>.  If the bucket already existed, then the server needs to be rebalanced for the setting to take affect.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="transactions-library"><a class="anchor" href="#transactions-library"></a>Transactions Library</h3>
<div class="paragraph">
<p>Couchbase transactions require no additional components or services to be configured.
Simply add the transactions library into your project.
Version <code>1.1.0</code> was released October 29th, 2021.<br>
See the <a href="../project-docs/distributed-transactions-dotnet-release-notes.html" class="xref page">Release Notes</a> for the latest version.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_nuget"></a>NuGet</p>
</li>
<li>
<p><a id="tabset2_cli"></a>CLI</p>
</li>
<li>
<p><a id="tabset2_csproj-file"></a>.csproj file</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_nuget">
<div class="paragraph">
<p>With NuGet this can be accomplished by using the NuGet Package Manager in your IDE:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>PM &gt; Install-Package Couchbase.Transactions -Version 1.1.0</pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_cli">
<div class="paragraph">
<p>You can also install the library with the dotnet CLI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ dotnet add package Couchbase.Transactions --version 1.1.0</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_csproj-file">
<div class="paragraph">
<p>If you&#8217;re using a .csproj file, add this <code>PackageReference</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PackageReference Include="Couchbase.Transactions" Version="1.1.0" /&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-transaction"><a class="anchor" href="#creating-a-transaction"></a>Creating a Transaction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The starting point is the <code>Transactions</code> object.
It is very important that an application ensures that only one of these is created per cluster, as it performs automated background clean-up processes that should not be duplicated.
In a dependency injection context, this instance should be injected as a singleton.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L35-L42">// Initialize the Couchbase cluster
var options = new ClusterOptions().WithCredentials("Administrator", "password");
var cluster = await Cluster.ConnectAsync("couchbase://localhost", options).ConfigureAwait(false);
var bucket = await cluster.BucketAsync("default").ConfigureAwait(false);
var collection = await bucket.ScopeAsync("inventory").CollectionAsync("airport").ConfigureAwait(false);

// Create the single Transactions object
var transactions = Transactions.Create(cluster, TransactionConfigBuilder.Create());</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-transaction-2"><a class="anchor" href="#creating-a-transaction-2"></a>Creating a Transaction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A core idea of Couchbase transactions is that an application supplies the logic for the transaction inside a lambda, including any conditional logic required, and the transaction is then automatically committed.
If a transient error occurs, such as a temporary conflict with another transaction, then the transaction will rollback what has been done so far and run the lambda again.
The application does not have to do these retries and error handling itself.</p>
</div>
<div class="paragraph">
<p>Each run of the lambda is called an <code>attempt</code>, inside an overall <code>transaction</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L135-L171">try
{
    var result = await _transactions.RunAsync(async (ctx) =&gt;
    {
        // Inserting a doc:
        var insertedDoc = await ctx.InsertAsync(_collection, "doc-a", new {}).ConfigureAwait(false);

        // Getting documents:
        // Use ctx.GetAsync if the document should exist, and the transaction
        // will fail if it does not
        var docA = await ctx.GetAsync(_collection, "doc-a").ConfigureAwait(false);

        // Replacing a doc:
        var docB = await ctx.GetAsync(_collection, "doc-b").ConfigureAwait(false);
        var content = docB.ContentAs&lt;dynamic&gt;();
        content.put("transactions", "are awesome");
        var replacedDoc = await ctx.ReplaceAsync(docB, content);

        // Removing a doc:
        var docC = await ctx.GetAsync(_collection, "doc-c").ConfigureAwait(false);
        await ctx.RemoveAsync(docC).ConfigureAwait(false);

        // This call is optional - if you leave it off, the transaction
        // will be committed anyway.
        await ctx.CommitAsync().ConfigureAwait(false);
    }).ConfigureAwait(false);
}
catch (TransactionCommitAmbiguousException e)
{
    Console.WriteLine("Transaction possibly committed");
    Console.WriteLine(e);
}
catch (TransactionFailedException e)
{
    Console.WriteLine("Transaction did not reach commit point");
    Console.WriteLine(e);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The lambda gets passed an <code>AttemptContext</code> object, generally referred to as <code>ctx</code> here.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since the lambda may be rerun multiple times, it is important that it does not contain any side effects.
In particular, you should never perform regular operations on a <code>Collection</code>, such as <code>collection.InsertAsync()</code>, inside the lambda.
Such operations may be performed multiple times, and will not be performed transactionally.
Instead such operations must be done through the <code>ctx</code> object, e.g. <code>ctx.InsertAsync()</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As with the Couchbase .NET Client, you should use the transactions library asynchronously using the async/await keywords.
The asynchronous API allows you to use the thread pool, which can help you scale with excellent efficiency.
However, operations inside an individual transaction should be kept in-order and executed using <code>await</code> immediately.
Do not use fire-and-forget tasks under any circumstances.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="logging"><a class="anchor" href="#logging"></a>Logging</h3>
<div class="paragraph">
<p>To aid troubleshooting, each transaction maintains a list of log entries, which can be logged on failure like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L435-L449">try
{
    var result = await transactions.RunAsync(async ctx =&gt; {
        // ... transactional code here ...
    });
}
catch (TransactionFailedException err)
{
    // ... log the error as you normally would
    // then include the logs
    foreach (var logLine in err.Result.Logs)
    {
        Console.Error.WriteLine(logLine);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A failed transaction can involve dozens, even hundreds, of lines of logging, so it may be preferable to write failed transactions into a separate file.</p>
</div>
<div class="paragraph">
<p>Please see the <a href="collecting-information-and-logging.html" class="xref page">.NET SDK logging documentation</a> for details.</p>
</div>
<div class="paragraph">
<p>Here is an example of configuring a <code>Microsoft.Extensions.Logging.ILoggingFactory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L456-L488">//Logging dependencies
var services = new ServiceCollection();
services.AddLogging(builder =&gt;
{
    builder.AddFile(AppContext.BaseDirectory);
    builder.AddConsole();
});
await using var provider = services.BuildServiceProvider();
var loggerFactory = provider.GetService&lt;ILoggerFactory&gt;();
var logger = loggerFactory.CreateLogger&lt;Program&gt;();

//create the transactions object and add the ILoggerFactory
var transactions = Transactions.Create(_cluster,
    TransactionConfigBuilder.Create().LoggerFactory(loggerFactory));
try
{
    var result = await transactions.RunAsync(async ctx =&gt; {
        // ... transactional code here ...
    });
}
catch (TransactionCommitAmbiguousException err)
{
    // The transaction may or may not have reached commit point
    logger.LogInformation("Transaction returned TransactionCommitAmbiguous and" +
                " may have succeeded, logs:");
    Console.Error.WriteLine(err);
}
catch (TransactionFailedException err)
{
    // The transaction definitely did not reach commit point
    logger.LogInformation("Transaction failed with TransactionFailed, logs:");
    Console.Error.WriteLine(err);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="key-value-operations"><a class="anchor" href="#key-value-operations"></a>Key-Value Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can perform transactional database operations using familiar key-value CRUD methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>C</strong>reate - <code>InsertAsync()</code></p>
</li>
<li>
<p><strong>R</strong>ead - <code>GetAsync()</code> or <code>GetOptionalAsync()</code></p>
</li>
<li>
<p><strong>U</strong>pdate - <code>ReplaceAsync()</code></p>
</li>
<li>
<p><strong>D</strong>elete - <code>RemoveAsync()</code></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As mentioned <a href="#lambda-ops">previously</a>, make sure your application uses the transactional key-value operations inside the lambda&#8201;&#8212;&#8201;such as <code>ctx.InsertAsync()</code>, rather than <code>collection.InsertAsync()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="insert"><a class="anchor" href="#insert"></a>Insert</h3>
<div class="paragraph">
<p>To insert a document within a transaction lambda, simply call <code>ctx.InsertAsync()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L178-L182">await _transactions.RunAsync(async ctx =&gt;
{
    var insertedDoc = await ctx.InsertAsync(_collection, "docId", new { }).ConfigureAwait(false);
}).ConfigureAwait(false);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="get"><a class="anchor" href="#get"></a>Get</h3>
<div class="paragraph">
<p>There are two ways to get a document, <code>GetAsync</code> and <code>GetOptionalAsync</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L189-L193">await _transactions.RunAsync(async ctx =&gt;
{
    var docId = "a-doc";
    var docOpt = await ctx.GetAsync(_collection, docId).ConfigureAwait(false);
}).ConfigureAwait(false);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>GetAsync</code> may return a <code>TransactionFailedException</code> if a document doesn&#8217;t exist, for example.
It is provided as a convenience method, so a developer does not have to check for <code>null</code> if the document must exist for the transaction to succeed&#8201;&#8212;&#8201;which is the case with <code>GetAsyncOptional</code>.</p>
</div>
<div class="paragraph">
<p>Gets will "Read Your Own Writes", e.g. this will succeed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L200-L206">await _transactions.RunAsync(async ctx =&gt;
{
    var docId = "docId";
    _ = await ctx.InsertAsync(_collection, docId, new { }).ConfigureAwait(false);
    var doc = await ctx.GetAsync(_collection, docId).ConfigureAwait(false);
    Console.WriteLine((object) doc.ContentAs&lt;dynamic&gt;());
}).ConfigureAwait(false);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, no other transaction will be able to read that inserted document, until this transaction reaches the commit point.</p>
</div>
</div>
<div class="sect2">
<h3 id="replace"><a class="anchor" href="#replace"></a>Replace</h3>
<div class="paragraph">
<p>Replacing a document requires awaiting a <code>TransactionGetResult</code> returned from <code>ctx.GetAsync()</code>, <code>ctx.InsertAsync()</code>, or another <code>ctx.ReplaceAsync()</code> call first.
This is necessary to ensure that the document is not involved in another transaction.
If it is, then the transaction will handle this, generally by rolling back what has been done so far, and retrying the lambda.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L213-L219">await _transactions.RunAsync(async ctx =&gt;
{
    var anotherDoc = await ctx.GetAsync(_collection, "anotherDoc").ConfigureAwait(false);
    var content = anotherDoc.ContentAs&lt;dynamic&gt;();
    content.put("transactions", "are awesome");
    _ = await ctx.ReplaceAsync(anotherDoc, content);
}).ConfigureAwait(false);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="remove"><a class="anchor" href="#remove"></a>Remove</h3>
<div class="paragraph">
<p>As with replaces, removing a document requires awaiting a <code>TransactionGetResult</code> from a previous transaction operation first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L226-L230">await _transactions.RunAsync(async ctx =&gt;
{
    var anotherDoc = await ctx.GetAsync(_collection, "anotherDoc").ConfigureAwait(false);
    await ctx.RemoveAsync(anotherDoc).ConfigureAwait(false);
}).ConfigureAwait(false);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sqlpp-queries"><a class="anchor" href="#sqlpp-queries"></a>{sqlpp} Queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you already use <a href="https://www.couchbase.com/products/n1ql">{sqlpp} (formerly N1QL)</a>, then its use in transactions is very similar.
A query returns the same <code>IQueryResult&lt;T&gt;</code> you are used to, and takes most of the same options.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As mentioned <a href="#lambda-ops">previously</a>, make sure your application uses the transactional query operations inside the lambda&#8201;&#8212;&#8201;such as <code>ctx.QueryAsync()</code>, rather than <code>cluster.QueryAsync()</code> or <code>scope.QueryAsync()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is an example of selecting some rows from the <code>travel-sample</code> bucket:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L514-L523">IBucket travelSample = await cluster.BucketAsync("travel-sample");
IScope inventory = travelSample.Scope("inventory");

var transactionResult = await transactions.RunAsync(async ctx =&gt;
{
    var st = "SELECT * FROM `travel-sample`.inventory.hotel WHERE country = $1";
    IQueryResult&lt;object&gt; qr = await ctx.QueryAsync&lt;object&gt;(st,
        options: new TransactionQueryOptions().Parameter("United Kingdom"),
        scope: inventory);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example using a <code>IScope</code> for an UPDATE:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L531-L543">var hotelChain = "http://marriot%";
var country = "United States";

await transactions.RunAsync(async ctx =&gt; {
    var qr = await ctx.QueryAsync&lt;object&gt;(
        statement: "UPDATE hotel SET price = $price WHERE url LIKE $url AND country = $country",
        configure: options =&gt; options.Parameter("price", 99.99m)
                          .Parameter("url", hotelChain)
                          .Parameter("country", country),
        scope: inventory);

    Console.Out.WriteLine($"Records Updated = {qr?.MetaData.Metrics.MutationCount}");
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>And an example combining <code>SELECT</code> and <code>UPDATE</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L554-L570">await transactions.RunAsync(async ctx =&gt; {
    // Find all hotels of the chain
    IQueryResult&lt;Review&gt; qr = await ctx.QueryAsync&lt;Review&gt;(
        statement: "SELECT reviews FROM hotel WHERE url LIKE $1 AND country = $2",
        configure: options =&gt; options.Parameter(hotelChain).Parameter(country),
        scope: inventory);

    // This function (not provided here) will use a trained machine learning model to provide a
    // suitable price based on recent customer reviews.
    var updatedPrice = PriceFromRecentReviews(qr);

    // Set the price of all hotels in the chain
    await ctx.QueryAsync&lt;object&gt;(
        statement: "UPDATE hotel SET price = $1 WHERE url LIKE $2 AND country = $3",
            configure: options =&gt; options.Parameter(hotelChain, country, updatedPrice),
            scope: inventory);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the snippet above, it is possible to call regular C# methods from the lambda, permitting complex logic to be performed.
Just remember that since the lambda may be called multiple times, so may the method.</p>
</div>
<div class="paragraph">
<p>Like key-value operations, queries support "Read Your Own Writes".
This example shows inserting a document and then selecting it again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L576-L586">await transactions.RunAsync(async ctx =&gt; {
    await ctx.QueryAsync&lt;object&gt;(
        "INSERT INTO `default` VALUES ('doc', {'hello':'world'})",
        TransactionQueryConfigBuilder.Create()
    );  <i class="conum" data-value="1"></i><b>(1)</b>

    // Performing a 'Read Your Own Write'
    var st = "SELECT `default`.* FROM `default` WHERE META().id = 'doc'"; <i class="conum" data-value="2"></i><b>(2)</b>
    IQueryResult&lt;object&gt; qr = await ctx.QueryAsync&lt;object&gt;(st, TransactionQueryConfigBuilder.Create());
    Console.Out.WriteLine($"ResultCount = {qr?.MetaData.Metrics.ResultCount}");
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The inserted document is only staged at this point, as the transaction has not yet committed.<br>
Other transactions, and other non-transactional actors, will not be able to see this staged insert yet.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>But the <code>SELECT</code> can, as we are reading a mutation staged inside the same transaction.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="query-options"><a class="anchor" href="#query-options"></a>Query Options</h3>
<div class="paragraph">
<p>Query options can be provided via <code>TransactionQueryOptions</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L661-L664">await transactions.RunAsync(async ctx =&gt; {
    await ctx.QueryAsync&lt;object&gt;("INSERT INTO `default` VALUES ('doc', {'hello':'world'})",
            new TransactionQueryOptions().FlexIndex(true));
});</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Supported Transaction Query Options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Parameter(Object)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to set positional arguments for a parameterized query.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Parameters(Object[])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to set named arguments for a parameterized query.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ScanConsistency(QueryScanConsistency)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets a different scan consistency for this query.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FlexIndex(Boolean)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tells the query engine to use a flex index (utilizing the search service).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Serializer(ITypeSerializer)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to use a different serializer for the decoding of the rows.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ClientContextId(String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets a context ID returned by the service for debugging purposes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ScanWait(TimeSpan)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to specify a maximum scan wait time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ScanCap(Int32)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a maximum cap on the query scan size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PipelineBatch(Int32)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the batch size for the query pipeline.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PipelineCap(Int32)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the cap for the query pipeline.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Readonly(Boolean)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tells the client and server that this query is readonly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AdHoc(Boolean)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to false will prepare the query and later execute the prepared statement.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Raw(String, Object)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Escape hatch to add arguments that are not covered by these options.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mixing-key-value-and-sqlpp"><a class="anchor" href="#mixing-key-value-and-sqlpp"></a>Mixing Key-Value and {sqlpp}</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Key-Value and {sqlpp} query operations can be freely intermixed, and will interact with each other as you would expect.
In this example we insert a document with a key-value operation, and read it with a <code>SELECT</code> query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L648-L655">await transactions.RunAsync(async ctx =&gt; {
    _ = await ctx.InsertAsync(collection, "doc", new { Hello = "world" }); <i class="conum" data-value="1"></i><b>(1)</b>

    // Performing a 'Read Your Own Write'
    var st = "SELECT `default`.* FROM `default` WHERE META().id = 'doc'"; <i class="conum" data-value="2"></i><b>(2)</b>
    var qr = await ctx.QueryAsync&lt;object&gt;(st);
    Console.Out.WriteLine($"ResultCount = {qr?.MetaData.Metrics.ResultCount}");
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The key-value insert operation is only staged, and so it is not visible to other transactions or non-transactional actors.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>But the <code>SELECT</code> can view it, as the insert was in the same transaction.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default configuration should be appropriate for most use-cases.
If needed, transactions can optionally be configured at the point of creating the <code>Transactions</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="file:///Users/hakimcassimally/couchbase/docs-sdk-dotnet//modules/howtos/examples/TransactionsExample.cs#L54-L57">var transactions = Transactions.Create(_cluster,
    TransactionConfigBuilder.Create()
        .DurabilityLevel(DurabilityLevel.PersistToMajority)
        .Build());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default configuration will perform all writes with the durability setting <code>Majority</code>, ensuring that each write is available in-memory on the majority of replicas before the transaction continues.
There are two higher durability settings available that will additionally wait for all mutations to be written to physical storage on either the active or the majority of replicas, before continuing.
This further increases safety, at a cost of additional latency.</p>
</div>
<div class="paragraph">
<p>A level of <code>None</code> is present but its use is discouraged and unsupported.
If durability is set to <code>None</code>, then ACID semantics are not guaranteed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional-resources"><a class="anchor" href="#additional-resources"></a>Additional Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Learn more about <a href="../concept-docs/transactions.html" class="xref page">Distributed ACID Transactions</a>.</p>
</li>
<li>
<p>Check out the Couchbase Transactions library <a href="https://docs.couchbase.com/sdk-api/couchbase-transactions-dotnet/">API Reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="view-queries-with-sdk.html">MapReduce Views</a></span>
  <span class="next"><a href="transactions-single-query.html">Single Query Transactions</a></span>
</nav>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
