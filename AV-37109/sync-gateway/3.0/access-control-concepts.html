<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Access Control Concepts | Couchbase Capella Staging Docs</title>
<link rel="canonical" href="https://docs.stage.nonprod-project-avengers.com/sync-gateway/3.0/access-control-concepts.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<meta name="description" content="An introduction to the key concepts behind the provision of effective access control in Sync Gateway">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="sync-gateway">
<meta name="dcterms.identifier" content="3.0">
<meta name="page-url" content="/sync-gateway/3.0/access-control-concepts.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.stage.nonprod-project-avengers.com/cloud/index.html">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.stage.nonprod-project-avengers.com/cloud/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="2">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/hakimcassimally/couchbase/docs-sync-gateway/modules/ROOT/pages/access-control-concepts.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="index.html">Sync Gateway</a></li>
<li class="crumb">Access Control</li>
<li class="crumb"><a href="access-control-concepts.html">Concepts</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Access Control Concepts</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>An introduction to the key concepts behind the provision of effective access control in Sync Gateway<br>
The sync function API provides several methods that you can use to validate and control user access to databases and documents.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><em>Related&nbspConcepts</em>:  <a href="access-control-model.html" class="xref page">Access Control Model</a>  |
<a href="channels.html" class="xref page">Channels</a>  |
<a href="roles.html" class="xref page">Roles</a>  |
<a href="sync-function-overview.html" class="xref page">Sync Function</a>  |
<a href="users.html" class="xref page">Users</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-access"><a class="anchor" href="#lbl-access"></a>Access Control Model</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="concept"><a class="anchor" href="#concept"></a>Concept</h3>
<div class="paragraph">
<p>You control document access by routing it to a channel and by making that channel accessible to the users or roles you want to be able to access documents of that type.</p>
</div>
</div>
<div class="sect2">
<h3 id="model"><a class="anchor" href="#model"></a>Model</h3>
<div class="paragraph">
<p>In the Couchbase Mobile ecosystem access to documents is governed by three key entities: <a href="users.html" class="xref page">users</a>, <a href="roles.html" class="xref page">roles</a> and <a href="channels.html" class="xref page">channels</a>.</p>
</div>
<div id="img-access-control-model" class="paragraph">
<div class="title">Access Control Model</div>
<p><span class="image"><img src="_images/access-control-triangle.png" alt="Access" width="400"></span></p>
</div>
<div class="paragraph">
<p>Conceptually, the <em>channel</em> can be considered as a <em>tag</em> associated with a document.
Every document processed by the Sync Gateway is assigned to a channel (user-defined or system-defined).
A channel is the fundamental way to segregate documents and for enforcing access control.</p>
</div>
<div class="paragraph">
<p>Every Sync Gateway user is granted access to zero, one or more channels.
It is the channels membership that determines the documents users can access&#8201;&#8212;&#8201;as illustrated in <a href="#img-access-control-model">Access Control Model</a></p>
</div>
<div class="paragraph">
<p>A Sync Gateway role is a way of logically grouping users.
Like the channel, a role is granted access to zero, one or more channels.</p>
</div>
<div class="paragraph">
<p>A user can only read documents that are in at least one of their assigned channels; whether directly or as part of an assigned role.</p>
</div>
</div>
<div class="sect2">
<h3 id="context"><a class="anchor" href="#context"></a>Context</h3>
<div class="paragraph">
<p>You control document access by routing it to a channel and by making that channel accessible to the users or roles you want to be able to access documents of that type.</p>
</div>
<div class="sect3">
<h4 id="sync-gateway"><a class="anchor" href="#sync-gateway"></a>Sync Gateway</h4>
<div class="paragraph">
<p>All users can implicitly access any document in the public channel.
In addition, there can be user-defined channels that users can be assigned to.</p>
</div>
<div class="paragraph">
<p>Once a user is granted access to a new channel, the next replication pull request from the client will retrieve all documents to which the user now has access.</p>
</div>
<div class="paragraph">
<p>Revoking access to a channel means that users who previously used the channel to get replicated documents will no longer see any synced updates.</p>
</div>
<div class="paragraph">
<p>Note that access grants neither confer, nor constrain, the <strong>type</strong> of access.
Instead you can explicitly implement write access controls within the Sync Function; perhaps restricting updates to specific users or roles — for more on this see <a href="access-control-how-control-document-access.html" class="xref page">Control Write Access</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="couchbase-lite"><a class="anchor" href="#couchbase-lite"></a>Couchbase Lite</h4>
<div class="paragraph">
<p>By default, Couchbase Lite gets all the channels to which the configured user account has access.
Optionally, a Couchbase Lite "pull" replication can also specify a comma-separated list of channel names to receive documents from.
In this case, the replication from Sync Gateway will only pull documents tagged with those channels.
Client apps can use this ability to intelligently sync with a subset of the available documents from the database.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-access-revocation"><a class="anchor" href="#lbl-access-revocation"></a>Channel Access Revocation</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">3.0 Breaking Change</div>
Whenever a user loses access to a channel (or channels) all document in the channel(s) are auto-purged from local Couchbase Lite databases.<br>
In <em>Sync&#160;Gateway</em> 2.x these documents remain in the local database on channel access loss.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Users may lose access to documents for many reasons, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The User loses direct access to channel</p>
</li>
<li>
<p>The User is removed from a role</p>
</li>
<li>
<p>A role the user belongs to is revoked access to channel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, when a user loses access to a channel, the next Couchbase Lite Pull replication auto-purges all documents in the channel from local Couchbase Lite databases (on devices belonging to the user) <strong>unless</strong> they belong to any of the user’s other channels&#8201;&#8212;&#8201;see: <a href="#tbl-sgw-behavior">Table 1</a>.</p>
</div>
<table id="tbl-sgw-behavior" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Sync&#160;Gateway behavior following access revocation</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">System State</th>
<th class="tableblock halign-left valign-top">Impact on Sync</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Replication Type</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Access Control on Sync Gateway</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Expected behavior (auto-purge enabled- default)</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Pull only</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>User revoked access to channel.</p>
</div>
<div class="paragraph">
<p>Sync Function includes <code>requireAccess(revokedChannel)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Previously synced documents are auto purged on local</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Push only</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>User revoked access to channel.</p>
</div>
<div class="paragraph">
<p>Sync Function includes <code>requireAccess(revokedChannel)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No impact of auto-purge</p>
</div>
<div class="paragraph">
<p>Documents get pushed but will be rejected by Sync Gateway</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Push-pull</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>User revoked access to channel</p>
</div>
<div class="paragraph">
<p>Sync Function includes <code>requireAccess(revokedChannel)`</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Previously synced documents are auto purged on Couchbase Lite.</p>
</div>
<div class="paragraph">
<p>Local changes continue to be  pushed to remote but are rejected by Sync Gateway</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="provisioning"><a class="anchor" href="#provisioning"></a>Provisioning</h3>
<div class="ulist">
<ul>
<li>
<p><a href="channels.html" class="xref page">Channel</a>&#8201;&#8212;&#8201;the channels topic discusses how channels are created and how documents can be assigned to channels.</p>
</li>
<li>
<p><a href="users.html" class="xref page">User</a>&#8201;&#8212;&#8201;the user topic discusses provisioning of users and providing users access to channels.</p>
</li>
<li>
<p><a href="roles.html" class="xref page">Role</a>&#8201;&#8212;&#8201;the role topic discusses roles, assignment of users to roles created and providing roles access to channels.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-channels"><a class="anchor" href="#lbl-channels"></a>Channels</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="concept-2"><a class="anchor" href="#concept-2"></a>Concept</h3>
<div class="paragraph">
<p><em>Sync Gateway</em> uses <em>Channels</em> to make it easy to share a database&#8217;s documents across a large user base whilst retaining effective access control.
They serve as a security conduit between the document and a user:</p>
</div>
</div>
<div class="sect2">
<h3 id="overview"><a class="anchor" href="#overview"></a>Overview</h3>
<div class="paragraph">
<p>Every document in the database is assigned a list of channels it is distributed to.
Every user (or role) is granted access to a list of channels.
This dual-purpose is reflected in the way you use channels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By granting a user access to a channel, you are imposing access control</p>
</li>
<li>
<p>By assigning a document to a channel you are imposing document routing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You typically will use channels to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Control who can access what</p>
</li>
<li>
<p>Partition your data set</p>
</li>
<li>
<p>Enable users to access just the documents they need</p>
</li>
<li>
<p>Minimize the amount of data synced to mobile devices</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Sync Gateway</em> provides two special channels and a channel wildcard character.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-usecase"><a class="anchor" href="#lbl-usecase"></a>Use Case</h3>
<div class="paragraph">
<p>Consider the case where two users require, and are allowed, access to a private set of documents  and one shared shared of documents — see <a href="#fig-channel-example">Figure 1</a>.</p>
</div>
<div id="fig-channel-example" class="imageblock">
<div class="content">
<img src="_images/channels-example-all.png" alt="Access Control using Channels" width="400">
</div>
<div class="title">Figure 1. Channels in Access Control</div>
</div>
<div class="paragraph">
<p>In this case, each user is assigned to a private channel with a subset of documents that only the user can access and a shared channel that contains common documents.
The users in this example could be replaced by roles.</p>
</div>
<div class="paragraph">
<p>An example of this model could be a retail chain, where every store corresponds to a <em>Sync Gateway</em> User.
Each store has a store specific channel that contains documents that are store specific like pricing, promotions, inventory etc.
In addition, all the stores may need to have access to a common set of documents like retail locations, product catalog that are stored in a common shared channel.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-config"><a class="anchor" href="#lbl-config"></a>Configuration</h3>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_version-3-x"></a>Version 3.x</p>
</li>
<li>
<p><a id="tabset1_legacy"></a>legacy</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_version-3-x">
<div class="imageblock">
<div class="content">
<img src="_images/channel-access-grant-3.0.png" alt="Access Control Points 3.x" width="400">
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using the Admin REST API:<br>
You can provide the <code>admin_channels</code> property using the <strong>Admin REST API</strong> endpoint (<a href="rest-api-admin.html#/user/post\__db___user_name_" class="xref page">/{tkn-db}/_user/{name}</a>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Programmatically using Access Grant Document:<br>
The <a href="sync-function.html" class="xref page">Sync Function</a> provides a flexible and secure method for controlling document access and routing.
You can program it to derive appropriate access and channel routing information from document properties.<br>
Optionally, the access grant can be specified via a designated extended attribute (XATTR) — see: <a href="access-control-how-use-xattrs-for-access-grants.html" class="xref page">Use XATTRs for Access Grants</a> for how to define the XATTR.</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_legacy">
<div class="imageblock">
<div class="content">
<img src="_images/channel-access-grant-pre3.0.png" alt="Access Control Points pre 3.x" width="400">
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using the Admin REST API :
You can provide the <code>admin_channels</code> property using the <strong>Admin REST API</strong> endpoint (<a href="rest-api-admin.html#/user/post\__db___user_name_" class="xref page">/{tkn-db}/_user/{name}</a>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Programmatically using Access Grant Document:
 The <a href="sync-function.html" class="xref page">Sync Function</a> provides a flexible and secure method for controlling document access and routing.<br>
You can program it to derive appropriate access and channel routing information from data embedded within document properties.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>File-based Configuration Properties:
This is only available in 3.x and is typically used for dev/test environments.
You can do it in the <em>Sync Gateway</em> JSON Configuration File (<a href="configuration-schema-database.html" class="xref page">Database Configuration</a> ) by adding the appropriate channel to the user’s admin_channels property&#8201;&#8212;&#8201;see: <a href="configuration-schema-database.html#database-users-this_user-admin_channels" class="xref page">user admin_channels</a>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-syschan"><a class="anchor" href="#lbl-syschan"></a>System Channels</h3>
<div class="sect3">
<h4 id="lbl-public-channel"><a class="anchor" href="#lbl-public-channel"></a>Public Channel</h4>
<div class="paragraph">
<p>The <a href="#lbl-public-channel">Public Channel</a> ('<strong>!</strong>')&#8201;&#8212;&#8201;is a channel for publicly available documents.
It is ideal for use in making information available across the user community.</p>
</div>
<div class="paragraph">
<p>You assign a document to the <em>public</em> (<strong>!</strong>) channel using the <a href="sync-function-api-channel-cmd.html" class="xref page">channel()</a> function.</p>
</div>
<div class="paragraph">
<p>Documents assigned to this channel can be accessed by all users; even users assigned no specific channel access.</p>
</div>
<div class="paragraph">
<p>New users are automatically granted access to the channel.</p>
</div>
</div>
<div class="sect3">
<h4 id="lbl-alldocs-channel"><a class="anchor" href="#lbl-alldocs-channel"></a>All Documents Channel</h4>
<div class="paragraph">
<p>The <a href="#lbl-alldocs-channel">All Documents Channel</a> ('<strong>*</strong>') <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>&#8201;&#8212;&#8201;is a single, internal channel, comprising all documents from all channels.</p>
</div>
<div class="paragraph">
<p>Assignment to this channel is automatic and implicit.
You cannot explicitly assign documents to the channel or remove documents from it.</p>
</div>
<div class="paragraph">
<p>This channel should not be confused with the use of the <a href="#lbl-all-channels">All Channels Wildcard</a> in access grants.</p>
</div>
</div>
<div class="sect3">
<h4 id="lbl-all-channels"><a class="anchor" href="#lbl-all-channels"></a>All Channels Wildcard</h4>
<div class="paragraph">
<p>The <a href="#lbl-all-channels">All Channels Wildcard</a> ('<strong>*</strong>')&#8201;&#8212;&#8201;used when granting user access, this wildcard grants access to any document in any channel.</p>
</div>
<div class="paragraph">
<p>You make dynamic user access grants in the sync function using the <a href="sync-function-api-access-cmd.html" class="xref page">access()</a> method.</p>
</div>
<div class="paragraph">
<p>Granting a user access with the <em>all channels</em> wildcard gives them access to any channel, and any document in any channel, including those from private channels.</p>
</div>
<div class="paragraph">
<p>Replications by users with <em>all channels</em> wildcard access will pull <strong>all</strong> documents.
Because of this potential for syncing large volumes of data (sync pulls all documents in the bucket), users with <em>all channels</em> wildcard access should use a channel filter to explicitly name the channel(s) to be sync&#8217;d.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Users granted access using the <em>all channels</em> wildcard <strong>do not</strong> inherit <a href="sync-function-api-require-access-cmd.html" class="xref page">requireAccess()</a> rights to any specific channel.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Always use a filter in conjunction with the <em>all channels</em> wildcard, to avoid sync unnecessarily pulling large numbers of documents to mobile devices.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You assign documents to channels in the <a href="sync-function.html" class="xref page">Sync Function</a>.</p>
</div>
<div class="paragraph">
<p>Channels are created as documents are assigned to them.</p>
</div>
<div class="paragraph">
<p>Valid channel names consist of text letters [<code>A–Z</code>, <code>a–z</code>], digits [<code>0–9</code>], and a few special characters [<code>= + / . , _ @</code>].
Channel names are case-sensitive.
Channels with no documents assigned to them are empty.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-chan-limits"><a class="anchor" href="#lbl-chan-limits"></a>Channel Limits</h3>
<table id="tbl-limits" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Guidance on Channel Assignment Limits</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 44.4444%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Limiting factor</th>
<th class="tableblock halign-center valign-top">Guidance Limit (Channels)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channels per document</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of memory consumed by the combined number of channels and access grants must fit within the maximum 1Mb xattr size limit&#8201;&#8212;&#8201;see: <a href="#tbl-metadata-size">Table 3</a>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channels per user</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The amount of memory consumed by channels must fit within the 20 MB available on Couchbase Server docs for storing metadata&#8201;&#8212;&#8201;see: <a href="#tbl-metadata-size">Table 3</a><br>
Note that the memory is retained for as long as the replication remains active.</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1,000</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="lbl-metda-limits"><a class="anchor" href="#lbl-metda-limits"></a>Sync Metadata Limits</h3>
<div class="paragraph">
<p>Every time a document is assigned to a new channel, the channel name is appended to that document&#8217;s sync metadata.</p>
</div>
<div class="paragraph">
<p>Therefore, a document&#8217;s set of channels is limited by the allowed sync metadata size described in <a href="#tbl-metadata-size">Table 3</a>.</p>
</div>
<table id="tbl-metadata-size" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Size Limits for Sync Metadata</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Value of <code>enable_shared_bucket_access</code></th>
<th class="tableblock halign-center valign-top">Size (Mb per Document)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">20</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Sync Gateway</em> will assign a document to a new channel as long as the sync metadata remains under the allowed limit.</p>
</div>
<div class="paragraph">
<p><strong>What to do when your channel count exceeds the usable space for sync metadata?</strong></p>
</div>
<div class="paragraph">
<p>In order to lower the sync metadata size per document, you can do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lower the number of channels per document.</p>
</li>
<li>
<p>Shorten the channel names.
A shorter channel name will occupy less space ("customer==0030169303" vs "cs==0030169303").</p>
</li>
<li>
<p>Lower the <a href="configuration-schema-database.html#database-revs_limit" class="xref page">revs_limit</a> value.
Indeed, a copy of channel metadata is retained for each revision of a document.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-users"><a class="anchor" href="#lbl-users"></a>Users</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="concept-3"><a class="anchor" href="#concept-3"></a>Concept</h3>
<div class="paragraph">
<p>Users are one of the cornerstone concepts of access control.
You can restrict document access to specific users and-or to users with specific roles.</p>
</div>
<div class="paragraph">
<p>As an entity a <em>user</em> comprises a name, password, list of <a href="roles.html" class="xref page">Roles</a> and a list of <a href="channels.html" class="xref page">Channels</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-sgw-users"><a class="anchor" href="#lbl-sgw-users"></a>Sync Gateway Users</h3>
<div class="paragraph">
<p>Sync Gateway users and roles have no relationship to <a href="#lbl-rbac-users">Couchbase Server&#8217;s <em>RBAC (Role-based Access Control) users</em></a>.
They are created and operate solely within the <em>Sync Gateway</em> ecosphere to govern access to replication data and to the Public API.</p>
</div>
<div class="paragraph">
<p>Users granted access to a <a href="channels.html" class="xref page">Channel</a> can access all documents assigned to that channel.</p>
</div>
<div class="paragraph">
<p>Users can also be assigned to zero or more <a href="roles.html" class="xref page">Roles</a>.
A user inherits the channel access of all roles it belongs to.
This is very much like Unix groups, except that roles do not form a hierarchy.</p>
</div>
<div class="paragraph">
<p>Sync Gateway user credentials can be used to authenticate access to the Public API; RBAC users are required for access to other API.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-rbac-users"><a class="anchor" href="#lbl-rbac-users"></a>RBAC Users</h3>
<div class="paragraph">
<p>Couchbase Server <em>RBAC user</em> credentials are required to authenticate and authorize access to the Admin and Metrics API.
You will need to create these users on Couchbase server in order to enable access&#8201;&#8212;&#8201;see: <a href="get-started-prepare.html#step-2create-rbac-user" class="xref page">Create RBAC users</a> for how to and <a href="#server:learn:security/authorization-overview.adoc" class="xref unresolved">Security Authorization Overview</a> for more on RBAC user authentication.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="roles"><a class="anchor" href="#roles"></a>Roles</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="concept-4"><a class="anchor" href="#concept-4"></a>Concept</h3>
<div class="paragraph">
<p>Roles are named collections of <a href="channels.html" class="xref page">Channels</a>.
They enable the grouping together of <a href="users.html" class="xref page">Users</a> with similar characteristics, which makes the management of large user populations easier.</p>
</div>
<div class="paragraph">
<p>Roles are granted access to channels. Any user assigned a role can access any channels (and documents within those channels) the role has been granted access to.</p>
</div>
<div class="paragraph">
<p>As an entity, roles comprise a name and a list of channels.</p>
</div>
<div class="paragraph">
<p>Any user associated with a role inherits the right to access any of the channels in the role’s list. This provides a convenient way to associate multiple channels with multiple users.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Roles have a separate namespace from users, so it’s possible to have a user and a role with the same name.
</td>
</tr>
</table>
</div>
<hr>
<h5 id="" class="discrete"></h5>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">Learn more &#8230;&#8203;</div>
<ul>
<li>
<p><a href="sync-function-overview.html" class="xref page">Sync Function</a></p>
</li>
<li>
<p><a href="import-filter.html" class="xref page">Import filter</a></p>
</li>
<li>
<p><a href="configuration-schema-access-control.html" class="xref page">Access Control</a></p>
</li>
<li>
<p><a href="#rest-api-admin.html#/Access_Control/update_sync_function" class="xref unresolved">Add/Update Sync Function</a></p>
</li>
<li>
<p><a href="sync-function-overview.html" class="xref page">Sync Function Overview</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="ulist">
<div class="title">Reference material &#8230;&#8203;</div>
<ul>
<li>
<p><a href="rest-api.html" class="xref page">Public REST API</a></p>
</li>
<li>
<p><a href="rest-api-admin.html" class="xref page">Admin REST API</a></p>
</li>
<li>
<p><a href="rest-api-metrics.html" class="xref page">Metrics REST API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-4"><a class="anchor" href="#-4"></a></h6>
<div class="paragraph">
<div class="title">Community</div>
<p><a href="https://forums.couchbase.com/c/mobile/14">Mobile Forum</a> |
<a href="https://blog.couchbase.com/">Blog</a> |
<a href="https://blog.couchbase.com/category/couchbase-mobile/?ref=blog-menu">Blog (Mobile)</a> |
<a href="https://docs.couchbase.com/tutorials/">Tutorials</a></p>
</div>
<div class="ulist">
<div class="title">Sync Function Blogs</div>
<ul>
<li>
<p><a href="https://blog.couchbase.com/augment-your-sync-function-with-roles-in-couchbase-sync-gateway/">Using roles in sync functions</a></p>
</li>
<li>
<p><a href="https://blog.couchbase.com/data-synchronization-offline-first-apps-couchbase/">Tutorial: Getting Started with Data Synchronization using Couchbase Mobile for Offline-First Apps</a></p>
</li>
<li>
<p><a href="https://blog.couchbase.com/tag/sync-function/">Sync Function (category)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Sometimes referred to as the <strong>star</strong> channel
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Mobile","components":["couchbase-lite","sync-gateway"],"url":"/home/mobile.html","latestVersions":{"couchbase-lite":"3.0","sync-gateway":"3.0"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../_/js/site.js"></script>
<script defer src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
