<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Sync with Couchbase Server | Couchbase Capella Staging Docs</title>
<link rel="canonical" href="https://docs.stage.nonprod-project-avengers.com/sync-gateway/3.0/sync-with-couchbase-server.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Use Sync Gateway to sync Couchbase Server changes securely from cloud to edge">
<meta name="keywords" content="sync gateway, replication, sync, synchronization, edge, cloud">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="sync-gateway">
<meta name="dcterms.identifier" content="3.0">
<meta name="page-url" content="/sync-gateway/3.0/sync-with-couchbase-server.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.stage.nonprod-project-avengers.com/cloud/index.html">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.stage.nonprod-project-avengers.com/cloud/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="2@">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/hakimcassimally/couchbase/docs-sync-gateway/modules/ROOT/pages/sync-with-couchbase-server.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="index.html">Sync Gateway</a></li>
<li class="crumb">Sync</li>
<li class="crumb"><a href="sync-with-couchbase-server.html">Sync with Server</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Sync with Couchbase Server</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Use Sync Gateway to sync Couchbase Server changes securely from cloud to edge<br>
This content explains how Sync Gateway synchronizes document changes made through Couchbase SDKs and N1QL queries.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Related <em>Sync</em> topics: <a href="sync-using-app.html" class="xref page">Sync Using App</a> |  <a href="sync-inter-syncgateway-overview.html" class="xref page">Inter Sync Gateway Sync - Overview</a>  | <a href="delta-sync.html" class="xref page">Delta Sync</a>  |  <a href="resync.html" class="xref page">Resync</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Users of Couchbase Server 6.0 should ensure they have addressed the known issue (<a href="https://issues.couchbase.com/browse/MB-41255">MB-41255</a>) by upgrading to one of the recommended Couchbase Server versions (6.0.5, 6.5.2, or 6.6.1).</p>
</div>
<div class="paragraph">
<p>The known issue can cause re-balance failures and/or failed replica writes of deleted or expired documents that use Xattrs.</p>
</div>
<div class="paragraph">
<p>This impacts Sync Gateway deployments running with shared bucket access enabled, which use Xattrs for metadata storage.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Sync&#160;Gateway</em> will automatically sync database changes if <a href="configuration-schema-database.html#database-import_docs" class="xref page">database.import_docs</a> and <a href="configuration-schema-database.html#database-enable_xttrs" class="xref page">database.enable_shared_bucket_access</a> are set 'true'.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable_Shared_Bucket_Access</p>
<div class="paragraph">
<p>This setting ensures that both sync&#160;gateway and <em>Couchbase&#160;Server</em> can read and write to the same bucket simultaneously and that sync&#160;gateway can access Couchbase&#160;Server document XATTRS<br>
See: <a href="#sgw-paths">Figure 1</a> and <a href="configuration-schema-database.html#database-enable_xttrs" class="xref page">database.enable_shared_bucket_access</a>.</p>
</div>
</li>
<li>
<p>Import Docs</p>
<div class="paragraph">
<p>Setting this property true ensures that the sync&#160;gateway node performs import processing, obtaining the mobile metadata it requires to replicate changes&#8201;&#8212;&#8201;see: <a href="#import-process">Import Processing</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure both these properties using the Admin Rest API <a href="configuration-schema-database.html" class="xref page">Database Configuration</a> endpoint.</p>
</div>
<div id="sgw-paths" class="imageblock">
<div class="content">
<img src="_images/shared-bucket-access.png" alt="shared bucket access">
</div>
<div class="title">Figure 1. Sync Gateway Data Access Paths</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sba-feature"><a class="anchor" href="#sba-feature"></a>Shared Bucket Access</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mobile applications require additional metadata in order to manage security and replication.</p>
</div>
<div class="paragraph">
<p>sync&#160;gateway stores this information using Couchbase&#160;Server XATTRs (see Couchbase&#160;Server documentation on <a href="../../server/7.2/learn/data/extended-attributes-fundamentals.html" class="xref page">Extended Attributes</a>).</p>
</div>
<div class="sect2">
<h3 id="extended-attributes-xattrs"><a class="anchor" href="#extended-attributes-xattrs"></a>Extended Attributes (XATTRs)</h3>
<div class="paragraph">
<p>A document can be associated with zero or more extended attributes.</p>
</div>
<div class="paragraph">
<p>There are currently three types of XATTRS: User, System and Virtual.</p>
</div>
<div class="paragraph">
<p>Extended attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Are JSON objects that can be associated with Couchbase documents.</p>
</li>
<li>
<p>Are stored and replicated along with the associated document in both intra-cluster and XDCR replication.</p>
</li>
<li>
<p>Can be accessed via Couchbase&#160;Server SDKs using the sub-document API, via command-line tools, and via views.</p>
</li>
<li>
<p>Are accessible from N1QL in Couchbase&#160;Server using the <code>().xattrs`</code> property.<br>
For example, <code>SELECT meta().xattrs._sync from travel-sample where Meta().id = "user::demo"</code>;.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both sync&#160;gateway and Couchbase&#160;Server use a System extended attribute, with the following characteristics to support mobile convergence (shared bucket access):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Shares lifetime with the document metadata - when a document is deleted, system xattrs are preserved with the tombstone.</p>
</li>
<li>
<p>Allocated 1MB of storage, independent of the 20MB available for the document</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The sync metadata is maintained internally by sync&#160;gateway and its structure can change at any time.
It should not be used to drive business logic of applications.
The direct use of the N1QL query is unsupported and must not be used in production environments.
The <code>_raw</code> endpoint (/db/_raw/{docid}) on sync&#160;gateway&#8217;s Admin REST API returns both the document and its associated mobile metadata.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="documents"><a class="anchor" href="#documents"></a>Documents</h3>
<div class="paragraph">
<p>With bucket-sharing enabled, Couchbase&#160;Server documents can be inserted directly (using <em>N1QL</em> or <em>SDKs</em>) or by using sync&#160;gateway&#8217;s <a href="rest-api.html" class="xref page">Public REST API</a>.</p>
</div>
<div class="paragraph">
<p>sync&#160;gateway <sup class="footnote" id="_footnote_sgw1x5">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> creates the metadata it needs by abstracting it from the SDK or N1QL applications reading and writing data directly to Couchbase&#160;Server buckets.
It uses Couchbase&#160;Server XATTRs <sup class="footnote" id="_footnote_cbs5x0">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> to store that metadata into an external document fragment&#8201;&#8212;&#8201;see <a href="../../server/7.2/learn/data/extended-attributes-fundamentals.html" class="xref page">Extended Attributes (XATTR)</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="blobs-and-attachments"><a class="anchor" href="#blobs-and-attachments"></a>Blobs and Attachments</h3>
<div class="paragraph">
<div class="title">Couchbase Server SDK/N1QL</div>
<p>Use sync&#160;gateway&#8217;s REST API&#8217;s <a href="rest-api-admin.html#/attachment" class="xref page">/{db}/{docid}/{attachment}</a> endpoints to
manage attachments and blob data; you cannot use Couchbase&#160;Server SDKs to do this
directly.</p>
</div>
<div class="paragraph">
<p>Standard practice would be to create the document using the SDK and then associate its blobs/attachments using the <a href="rest-api-admin.html#/attachment/put__db___doc___attachment_" class="xref page">Add/Update Attachment (/{db}/{docid}/{attachment})</a> endpoint.
You can see a practical example in this blog post&#8201;&#8212;&#8201;<a href="https://blog.couchbase.com/store-sync-binary-data-attachments-blobs-couchbase-mobile" class="bare">https://blog.couchbase.com/store-sync-binary-data-attachments-blobs-couchbase-mobile</a></p>
</div>
<div class="paragraph">
<div class="title">Couchbase Lite Apps</div>
<p>Couchbase Lite apps seamlessly handle blobs and attachments, see the appropriate platform examples here:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Related Couchbase Lite content</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><a href="#3.0@couchbase-lite:android:blob.adoc" class="xref unresolved">Android</a> |
<a href="#3.0@couchbase-lite:c:blob.adoc" class="xref unresolved">C</a> |
<a href="#3.0@couchbase-lite:csharp:blob.adoc" class="xref unresolved">C#</a> |
<a href="#3.0@couchbase-lite:java:blob.adoc" class="xref unresolved">Java</a> |
<a href="#3.0@couchbase-lite:objc:blob.adoc" class="xref unresolved">Objective-C</a> |
<a href="#3.0@couchbase-lite:swift:blob.adoc" class="xref unresolved">Swift</a></p>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Using a WebApp</div>
<p>Attachments can be accessed through sync&#160;gateway&#8217;s REST API using the <a href="rest-api.html#/attachment/GetAttachment_" class="xref page">/{tkn-db}/{doc}/{attachment}</a> endpoint.</p>
</div>
</div>
<div class="sect2">
<h3 id="tombstone-revisions"><a class="anchor" href="#tombstone-revisions"></a>Tombstone Revisions</h3>
<div class="paragraph">
<p>Note that, with bucket-sharing enabled, <a href="glossary.html#tombstone-revision" class="xref page">tombstone revision<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a>s are <strong>not</strong> retained indefinitely; they are purged based on the server&#8217;s <em>metadata purge interval</em>.</p>
</div>
<div class="paragraph">
<p>To ensure tombstones are synced with clients, you should set the server&#8217;s metadata purge interval based on your expected replication frequency&#8201;&#8212;&#8201;see the <a href="configuration-schema-database.html#database-enable_shared_bucket_access" class="xref page">$dbname.enable_shared_bucket_access</a> reference.</p>
</div>
</div>
<div class="sect2">
<h3 id="accessing-sync-metadata"><a class="anchor" href="#accessing-sync-metadata"></a>Accessing Sync Metadata</h3>
<div class="paragraph">
<p>As stated, mobile metadata is not kept in the document, but in a system extended attribute (XATTR) in Couchbase&#160;Server.</p>
</div>
<div class="paragraph">
<p>The N1QL query language <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> supports the ability to query these extended attributes (XATTRS) and hence the document&#8217;s sync metadata&#8201;&#8212;&#8201;see: <a href="#simple-query">Example 1</a>.</p>
</div>
<div id="simple-query" class="exampleblock">
<div class="title">Example 1. Querying XATTRS-bsed sync metadata</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT meta().xattrs._sync FROM `travel-sample` WHERE meta().id = "mydocId"</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The sync metadata is maintained internally by sync&#160;gateway and its structure can change at any time.
It should not be used to drive business logic of applications. The direct use of the N1QL query is <strong>unsupported</strong> and must not be used in production environments.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="enable-shared-bucket-access"><a class="anchor" href="#enable-shared-bucket-access"></a>Enable Shared Bucket Access</h3>
<div class="paragraph">
<p>Shared bucket access is an opt-in feature.
You can enable it without bringing down the entire sync&#160;gateway cluster &#8201;&#8212;&#8201;see <a href="#enable-sba">Example 2</a>.</p>
</div>
<div id="enable-sba" class="exampleblock">
<div class="title">Example 2. Enable Bucket-Sharing</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "databases": {
        "db": {
            "name": "dbname",
            "bucket": "my-bucket",
            "import_docs": true <i class="conum" data-value="1"></i><b>(1)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>import_docs</code> property is used to specify that a sync&#160;gateway node participates (exclusively) in <a href="#import-process.adoc" class="xref unresolved">Import Process</a>. The mechanism by which sync&#160;gateway incorporates changes to data buckets it shares with Couchbase&#160;Server&#8201;&#8212;&#8201;see: <a href="#import-process">Import Processing</a>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="import-process"><a class="anchor" href="#import-process"></a>Import Processing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>import process</strong> is a key part of mobile convergence.
It is the means by which sync&#160;gateway becomes aware of non-sync&#160;gateway data changes and obtains the mobile metadata it requires to replicate changes.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/shared-bucket-access.png" alt="shared bucket access">
</div>
</div>
<div class="paragraph">
<p>Any non-sync&#160;gateway change is eligible for import.
The document is first run through the Sync Function to compute read security and routing, with the following differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The import is processed with an admin user context in the Sync Function, similar to writes made through the sync&#160;gateway Admin API.
This means that <code>requireAccess</code>, <code>requireUser</code> and <code>requireRole</code> calls in the Sync Function are treated as no-ops.</p>
</li>
<li>
<p>During import, <code>oldDoc</code> is <code>nil</code> when the Sync Function is executed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify a filter function using the <a href="configuration-schema-database.html#database_import_filter" class="xref page">import_filter</a> property, which will only import specific documents.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use the <a href="configuration-schema-bootstrap.html#logging-console-log_keys" class="xref page">logging.console.log_keys</a> log key to troubleshoot import processing issues in the logs.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h3>
<div class="paragraph">
<p>Note that <code>import_docs</code> only takes effect if the <code>enabled_shared_bucket_access</code> is set to <code>true</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></dt>
<dd>
<p>The <code>import_docs</code> parameter defaults to <code>true</code>, implying that, by default, all nodes in a cluster participate in import processing.
To exclude a node, set <code>"import_docs": false</code>.</p>
</dd>
<dt class="hdlist1"><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a></dt>
<dd>
<p>The <code>import_docs</code> parameter defaults to false and must be explicitly set to <code>true</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following table describes the key behavior differences between Community Edition and Enterprise Edition when <code>import_docs</code> is enabled, disabled or not set at all.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><code>enabled_shared_bucket_access</code></th>
<th class="tableblock halign-center valign-top"><code>import_docs</code></th>
<th class="tableblock halign-left valign-top">Behavior (EE)</th>
<th class="tableblock halign-left valign-top">Behavior (CE)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assumes <code>import: true</code> by default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assumes <code>import: false</code> by default</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node omitted from import processing (supported for workload isolation)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node omitted from import processing</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node participates in import processing, and is assigned import partitions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node performs import processing for all server mutations.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">import docs is false by default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">import docs is false by default</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">import docs property ignored, warning logged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">import docs property ignored, warning logged</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import docs is false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import docs is false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="high-availability"><a class="anchor" href="#high-availability"></a>High Availability</h3>
<div class="paragraph">
<p>In <em>Enterprise Edition</em>, import processing work is sharded across all sync&#160;gateway nodes with import enabled.
This implies that if one of the nodes fail, the failed shard is automatically picked up by the remaining nodes in the cluster.
This way, you get High Availability of import processing.</p>
</div>
<div class="paragraph">
<p>In <em>Community Edition</em>, there is no sharding of import across the nodes participating in the import processing.
Each import node processes all server mutations.</p>
</div>
</div>
<div class="sect2">
<h3 id="workload-isolation"><a class="anchor" href="#workload-isolation"></a>Workload Isolation</h3>
<div class="paragraph">
<p>As described in the table above, if <code>import_docs</code> is set to <code>false</code>, the node will not be participating in the import process.
This configuration is specifically recommended for workload isolation: to isolate import nodes from the client-facing nodes.
Workload isolation may be preferable in deployments with high write throughput.</p>
</div>
<div class="paragraph">
<p>The following diagram shows an example architecture of two sync&#160;gateway nodes handling the incoming client connections (<code>import_docs: false</code>) and two nodes sharing the import processing (<code>import_docs: true</code>).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/workload-isolation.png" alt="workload isolation"></span></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Next Steps</div>
<div class="ulist">
<ul>
<li>
<p>Check out our getting started tutorial for more on how to setup, configure and run sync&#160;gateway replications - <a href="#tutorials:userprofile-sync:userprofile_sync.adoc" class="xref unresolved">Sync tutorial</a></p>
</li>
<li>
<p>Further reading:</p>
<div class="ulist">
<ul>
<li>
<p>Couchbase&#160;Server documentation on <a href="../../server/7.2/learn/data/extended-attributes-fundamentals.html" class="xref page">Extended Attributes</a></p>
</li>
<li>
<p>Configuration file references:</p>
<div class="ulist">
<ul>
<li>
<p><a href="configuration-schema-database.html#database-enable_shared_bucket_access" class="xref page">$dbname.enable_shared_bucket_access</a> to enable convergence for a given database.</p>
</li>
<li>
<p><a href="configuration-schema-database.html#database-import_docs" class="xref page">$dbname.import_docs</a> to give a particular sync&#160;gateway node the role of importing the documents.</p>
</li>
<li>
<p><a href="configuration-schema-database.html#database-import_filter" class="xref page">$dbname.import_filter</a> to select which document(s) to make aware to mobile clients.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<hr>
<h5 id="" class="discrete"></h5>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">API Topics</div>
<ul>
<li>
<p><a href="rest-api.html" class="xref page">Public REST API</a></p>
</li>
<li>
<p><a href="rest-api-admin.html" class="xref page">Admin REST API</a></p>
</li>
<li>
<p><a href="rest-api-metrics.html" class="xref page">Metrics REST API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="configuration-schema-bootstrap.html" class="xref page">Bootstrap</a></p>
</li>
<li>
<p><a href="configuration-schema-database.html" class="xref page">Database</a></p>
</li>
<li>
<p><a href="configuration-schema-db-security.html" class="xref page">Database Security</a></p>
</li>
<li>
<p><a href="configuration-schema-access-control.html" class="xref page">Access Control</a></p>
</li>
<li>
<p><a href="configuration-schema-import-filter.html" class="xref page">Import Filter</a></p>
</li>
<li>
<p><a href="configuration-schema-isgr.html" class="xref page">Inter-Sync&#160;Gateway Replication</a></p>
</li>
<li>
<p><a href="configuration-properties-legacy.html" class="xref page">Legacy Pre-3.0 Configuration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-4"><a class="anchor" href="#-4"></a></h6>
<div class="paragraph">
<div class="title">Community</div>
<p><a href="https://forums.couchbase.com/c/mobile/14">Mobile Forum</a> |
<a href="https://blog.couchbase.com/">Blog</a> |
<a href="https://blog.couchbase.com/category/couchbase-mobile/?ref=blog-menu">Blog (Mobile)</a> |
<a href="https://docs.couchbase.com/tutorials/">Tutorials</a></p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. As of Sync Gateway 1.5
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. As of Couchbase Server 5.0
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Mobile","components":["sync-gateway"],"url":"/home/mobile.html","latestVersions":{"sync-gateway":"3.0"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../_/js/site.js"></script>
<script defer src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
