<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>QueryBuilder | Couchbase Capella Staging Docs</title>
<link rel="canonical" href="https://docs.stage.nonprod-project-avengers.com/couchbase-lite/2.8/csharp/querybuilder.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="How to use QueryBuilder to build effective queries with Couchbase Lite on C#">
<meta name="keywords" content="sql, n1ql">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="couchbase-lite">
<meta name="dcterms.identifier" content="2.8">
<meta name="page-url" content="/couchbase-lite/2.8/csharp/querybuilder.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.stage.nonprod-project-avengers.com/cloud/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.stage.nonprod-project-avengers.com/cloud/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/csharp/pages/querybuilder.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">Couchbase Lite</a></li>
<li class="crumb"><a href="quickstart.html">C#.NET</a></li>
<li class="crumb">Queries</li>
<li class="crumb"><a href="querybuilder.html">Querybuilder</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">QueryBuilder</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/_partials/_std-cbl-hdr.adoc - include::shared-mobile::partial$_attributes-shared.adoc[]</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/_partials/_glossary-links.adoc - include::shared-mobile::partial$_attributes-shared.adoc[]</p>
</div>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Description&#8201;&#8212;&#8201;<em>How to use QueryBuilder to build effective queries with Couchbase Lite on C#</em><br>
Related Content&#8201;&#8212;&#8201;<a href="query-predictive.html" class="xref page">Predictive Query</a> | <a href="query-live.html" class="xref page">Live Query</a> | <a href="indexing.html" class="xref page">Indexing</a></p>
</div>
</blockquote>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The examples used in this topic are based on the <em>Travel Sample</em> app and data introduced in the <a href="https://docs.couchbase.com/tutorials/mobile-travel-sample/introduction.html">Couchbase Mobile Workshop</a> tutorial
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite for C#.Net&#8217;s database queries are defined using the QueryBuilder API.
This uses query statements of the form shown in <a href="#ex-query-form">Example 1</a>.
The structure and semantics of the query format are based on that of Couchbase&#8217;s <a href="#server:learn:data/n1ql-versus-sql.adoc" class="xref unresolved">N1QL query language</a>.</p>
</div>
<div id="ex-query-form" class="exampleblock">
<div class="title">Example 1. Query Format</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL hljs" data-lang="SQL">SELECT ____ <i class="conum" data-value="1"></i><b>(1)</b>
FROM 'database' <i class="conum" data-value="2"></i><b>(2)</b>
WHERE ____, <i class="conum" data-value="3"></i><b>(3)</b>
JOIN ____ <i class="conum" data-value="4"></i><b>(4)</b>
GROUP BY ____ <i class="conum" data-value="5"></i><b>(5)</b>
ORDER BY ____ <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Query Components</dt>
<dd>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="#lbl-select">SELECT statement</a> specifies the document properties that will be returned in the result set</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>FROM specifies the database to query the documents from</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="#lbl-where">WHERE statement</a> specifies the query criteria.<br>
The `SELECT`ed properties of documents matching this criteria will be returned in the result set</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><a href="#lbl-join">JOIN statement</a> specifies the criteria for joining multiple documents</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><a href="#lbl-group">GROUP BY statement</a> specifies the criteria used to group returned items in the result set</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><a href="#lbl-order">ORDER BY statement</a> specifies the criteria used to order the items in the result set</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We recommend working through the query section of the <a href="https://docs.couchbase.com/tutorials/mobile-travel-sample/introduction.html">Couchbase Mobile Workshop</a> as a good way to build your skills in this area.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="indexing"><a class="anchor" href="#indexing"></a>Indexing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we begin querying documents, let&#8217;s briefly mention the importance of having a query index.
A query can only be fast if there&#8217;s a pre-existing database index it can search to narrow down the set of documents to examine&#8201;&#8212;&#8201;see: <a href="#ex-indexing">Example 2</a>, which shows how to create an index and our <a href="query-troubleshooting.html" class="xref page">Query Troubleshooting</a> topic.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the <a href="indexing.html" class="xref page">Indexing</a> topic to learn more about indexing.
</td>
</tr>
</table>
</div>
<div id="ex-indexing" class="exampleblock">
<div class="title">Example 2. Creating a New Index</div>
<div class="content">
<div class="paragraph">
<p>This example creates a new index for the <code>type</code> and <code>name</code> properties in the <a href="#lbl-data-format">Data Format</a> shown.</p>
</div>
<div id="lbl-data-format" class="listingblock">
<div class="title">Data Format</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  { <i class="conum" data-value="1"></i><b>(1)</b>
    "id": "hotel123",
    "type": "hotel",
    "name": "Hotel Ghia"
  },
  { <i class="conum" data-value="2"></i><b>(2)</b>
    "id": "hotel456",
    "type": "hotel",
    "name": "Hotel Deluxe",
  }
]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Code to Create Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L564-L568">// For value types, this is optional but provides performance enhancements
var index = IndexBuilder.ValueIndex(
    ValueIndexItem.Expression(Expression.Property("type")),
    ValueIndexItem.Expression(Expression.Property("name"))); <i class="conum" data-value="1"></i><b>(1)</b>
db.CreateIndex("TypeNameIndex", index);</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Every index has to be updated whenever a document is updated, so too many indexes can hurt performance.
Thus, good performance depends on designing and creating the <em>right</em> indexes to go along with your queries.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-select"><a class="anchor" href="#lbl-select"></a>SELECT statement</h2>
<div class="sectionbody">
<div class="openblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-return-properties">Return Selected Properties</a>&#160;&#160;|&#160;&#160; <a href="#lbl-return-all">Return All Properties</a></p>
</dd>
<dt class="hdlist1">Related</dt>
<dd>
<p><a href="#lbl-resultsets">Handling result sets</a></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>Use the <code>SELECT</code> statement to specify which properties you want to return from the queried documents.
You can opt to retrieve entire documents, or just the specific properties you need.</p>
</div>
<div class="sect2">
<h3 id="lbl-return-all"><a class="anchor" href="#lbl-return-all"></a>Return All Properties</h3>
<div class="paragraph">
<p>Use the <code>SelectResult.all()</code> method to return all the properties of selected documents&#8201;&#8212;&#8201;see: <a href="#ex-select-all">Example 3</a>.</p>
</div>
<div id="ex-select-all" class="exampleblock">
<div class="title">Example 3. Using SELECT to Retrieve All Properties</div>
<div class="content">
<div class="paragraph">
<p>This query shows how to retrieve all properties from all documents in your database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L596-L599">using (var query = QueryBuilder.Select(SelectResult.All())
    .From(DataSource.Database(db))) {
    // All user properties will be available here
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The query.execute statement returns the results in a dictionary, where the key is the database name&#8201;&#8212;&#8201;see <a href="#ex-return-all">Example 4</a>.</p>
</div>
<div id="ex-return-all" class="exampleblock">
<div class="title">Example 4. Return Data Format from SelectResult.all()</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "travel-sample": { <i class="conum" data-value="1"></i><b>(1)</b>
      "callsign": "MILE-AIR",
      "country": "United States",
      "iata": "Q5",
      "icao": "MLA",
      "id": 10,
      "name": "40-Mile Air",
      "type": "airline"
    }
  },
  {
    "travel-sample": { <i class="conum" data-value="2"></i><b>(2)</b>
      "callsign": "ALASKAN-AIR",
      "country": "United States",
      "iata": "AA",
      "icao": "AAA",
      "id": 10,
      "name": "Alaskan Airways",
      "type": "airline"
    }
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we see the result for the first document matching the query criteria.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Here we see the result for the next document matching the query criteria.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>See: <a href="#lbl-resultsets">Result Sets</a> for more on processing query results.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-return-properties"><a class="anchor" href="#lbl-return-properties"></a>Return Selected Properties</h3>
<div class="paragraph">
<p>To access only specific properties, specify a comma separated list of <code>SelectResult</code> expressions, one for each property, in the select statement of your query &#8201;&#8212;&#8201;see: <a href="#ex-select-properties">Example 5</a></p>
</div>
<div id="ex-select-properties" class="exampleblock">
<div class="title">Example 5. Using SELECT to Retrieve Specific Properties</div>
<div class="content">
<div class="paragraph">
<p>In this query we retrieve and then print the <code>_id</code>, <code>type</code> and <code>name</code> properties of each document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">[data-source-url=https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>query.execute</code> statement returns one or more key-value pairs, one for each SelectResult expression, with the property-name as the key&#8201;&#8212;&#8201;see <a href="#ex-return-properties">Example 6</a></p>
</div>
<div id="ex-return-properties" class="exampleblock">
<div class="title">Example 6. Select Result Format</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  { <i class="conum" data-value="1"></i><b>(1)</b>
    "id": "hotel123",
    "type": "hotel",
    "name": "Hotel Ghia"
  },
  { <i class="conum" data-value="2"></i><b>(2)</b>
    "id": "hotel456",
    "type": "hotel",
    "name": "Hotel Deluxe",
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we see the result for the first document matching the query criteria.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Here we see the result for the next document matching the query criteria.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>See: <a href="#lbl-resultsets">Result Sets</a> for more on processing query results.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-where"><a class="anchor" href="#lbl-where"></a>WHERE statement</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-comp-ops">Comparison Operators</a>&#160;&#160;|&#160;&#160;
<a href="#lbl-coll-ops">Collection Operators</a>&#160;&#160;|&#160;&#160;
<a href="#lbl-like-ops">Like Operator</a>&#160;&#160;|&#160;&#160;
<a href="#lbl-regex-ops">Regex Operator</a>&#160;&#160;|&#160;&#160;
<a href="#lbl-deleted-ops">Deleted Document</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Like SQL, you can use the <code>WHERE</code> statement to choose  which documents are returned by your query.
The select statement takes in an <code>Expression</code>.
You can chain any number of Expressions in order to implement sophisticated filtering capabilities.</p>
</div>
<div class="sect2">
<h3 id="lbl-comp-ops"><a class="anchor" href="#lbl-comp-ops"></a>Comparison Operators</h3>
<div class="paragraph">
<p>The <a href="http://docs.couchbase.com/mobile/{major}.{minor}.4/couchbase-lite-net/api/Couchbase.Lite.Query.IExpression.html#Couchbase_Lite_Query_IExpression_">Expression Comparators</a> can be used in the WHERE statement to specify on which property to match documents.
In the example below, we use the <code>equalTo</code> operator to query documents where the <code>type</code> property equals "hotel".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  { <i class="conum" data-value="1"></i><b>(1)</b>
    "id": "hotel123",
    "type": "hotel",
    "name": "Hotel Ghia"
  },
  { <i class="conum" data-value="2"></i><b>(2)</b>
    "id": "hotel456",
    "type": "hotel",
    "name": "Hotel Deluxe",
  }
]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L634-L642">using (var query = QueryBuilder.Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
    .Limit(Expression.Int(10))) {
    foreach (var result in query.Execute()) {
        var dict = result.GetDictionary(db.Name);
        Console.WriteLine($"Document Name :: {dict?.GetString("name")}");
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-coll-ops"><a class="anchor" href="#lbl-coll-ops"></a>Collection Operators</h3>
<div class="paragraph">
<p><a href="http://docs.couchbase.com/mobile/{major}.{minor}.4/couchbase-lite-net/api/Couchbase.Lite.Query.ArrayFunction.html">ArrayFunction Collection Operators</a> are useful to check if a given value is present in an array.</p>
</div>
<div class="sect3">
<h4 id="contains-operator"><a class="anchor" href="#contains-operator"></a>CONTAINS Operator</h4>
<div class="paragraph">
<p>The following example uses the <code><a href="http://docs.couchbase.com/mobile/{major}.{minor}.4/couchbase-lite-net/api/Couchbase.Lite.Query.ArrayFunction.html">ArrayFunction</a></code> to find documents where the <code>public_likes</code> array property contains a value equal to "Armani Langworth".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "_id": "hotel123",
    "name": "Apple Droid",
    "public_likes": ["Armani Langworth", "Elfrieda Gutkowski", "Maureen Ruecker"]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L652-L665">using (var query = QueryBuilder.Select(
        SelectResult.Expression(Meta.ID),
        SelectResult.Property("name"),
        SelectResult.Property("public_likes"))
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").EqualTo(Expression.String("hotel"))
        .And(ArrayFunction.Contains(Expression.Property("public_likes"),
            Expression.String("Armani Langworth"))))) {
    foreach (var result in query.Execute()) {
        var publicLikes = result.GetArray("public_likes");
        var jsonString = JsonConvert.SerializeObject(publicLikes);
        Console.WriteLine($"Public Likes :: {jsonString}");
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="in-operator"><a class="anchor" href="#in-operator"></a>IN Operator</h4>
<div class="paragraph">
<p>The <code>IN</code> operator is useful when you need to explicitly list out the values to test against.
The following example looks for documents whose <code>first</code>, <code>last</code> or <code>username</code> property value equals "Armani".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L675-L687">var values = new IExpression[]
    { Expression.Property("first"), Expression.Property("last"), Expression.Property("username") };

using (var query = QueryBuilder.Select(
        SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.String("Armani").In(values))) {
    foreach (var result in query.Execute()) {
        var body = result.GetDictionary(0);
        var jsonString = JsonConvert.SerializeObject(body);
        Console.WriteLine($"In results :: {jsonString}");
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-like-ops"><a class="anchor" href="#lbl-like-ops"></a>Like Operator</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-string-match">String Matching</a>&#160;&#160;|&#160;&#160;
<a href="#lbl-wild-match">Wildcard Match</a>&#160;&#160;|&#160;&#160;
<a href="#lbl-wild-chars">Wildcard Character Match</a></p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="lbl-string-match"><a class="anchor" href="#lbl-string-match"></a>String Matching</h4>
<div class="paragraph">
<p>The <a href="http://docs.couchbase.com/mobile/{major}.{minor}.4/couchbase-lite-net/api/Couchbase.Lite.Query.IExpression.html#Couchbase_Lite_Query_IExpression_Like_Couchbase_Lite_Query_IExpression_">Like()</a> operator can be used for string matching.</p>
</div>
<div class="paragraph">
<p>The <code>like</code> operator performs <strong>case sensitive</strong> matches.<br>
To perform case insensitive matching, use <code>Function.lower</code> or <code>Function.upper</code> to ensure all comparators have the same case, thereby removing the case issue.</p>
</div>
<div id="ex-like-case-insensitive" class="exampleblock">
<div class="title">Example 7. Case-insensitive Matching</div>
<div class="content">
<div class="paragraph">
<p>This query returns <code>landmark</code> type documents where the <code>name</code> matches the string "Royal Engineers Museum", regardless of how it is capitalized (so, it selects "royal engineers museum", "ROYAL ENGINEERS MUSEUM" and so on).</p>
</div>
<div class="paragraph">
<p>Note the use of <code>Function.lower</code> to transform <code>name</code> values to the same case as the literal comparator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L697-L707">using (var query = QueryBuilder.Select(
        SelectResult.Expression(Meta.ID),
        SelectResult.Property("name"))
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
        .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Royal Engineers Museum"))))
    .Limit(Expression.Int(10))) {
    foreach (var result in query.Execute()) {
        Console.WriteLine($"Name Property :: {result.GetString("name")}");
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="lbl-wild-match"><a class="anchor" href="#lbl-wild-match"></a>Wildcard Match</h4>
<div class="paragraph">
<p>We can use <code>%</code> sign within a <code>like</code> expression to do a wildcard match against zero or more characters.
Using wildcards allows you to have some fuzziness in your search string.</p>
</div>
<div class="paragraph">
<p>In the example below, we are looking for documents of <code>type</code> "landmark" where the name property matches any string that begins with "eng" followed by zero or more characters, the letter "e", followed by zero or more characters.
Once again, we are using <code>Function.lower</code> to make the search case insensitive.</p>
</div>
<div class="paragraph">
<p>The following query will return "landmark" <code>type</code> documents with name matching "Engineers", "engine", "english egg" , "England Eagle" and so on.
Notice that the matches may span word boundaries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L717-L727">using (var query = QueryBuilder.Select(
        SelectResult.Expression(Meta.ID),
        SelectResult.Property("name"))
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
        .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Eng%e%"))))
    .Limit(Expression.Int(10))) {
    foreach (var result in query.Execute()) {
        Console.WriteLine($"Name Property :: {result.GetString("name")}");
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="lbl-wild-chars"><a class="anchor" href="#lbl-wild-chars"></a>Wildcard Character Match</h4>
<div class="paragraph">
<p>We can use an <code>_</code> sign within a like expression to do a wildcard match against a single character.</p>
</div>
<div class="paragraph">
<p>In the example below, we are looking for documents of type "landmark" where the <code>name</code> property matches any string that begins with "eng" followed by exactly 4 wildcard characters and ending in the letter "r".
The following query will return "landmark" <code>type</code> documents with the <code>name</code> matching "Engineer", "engineer" and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L737-L747">using (var query = QueryBuilder.Select(
        SelectResult.Expression(Meta.ID),
        SelectResult.Property("name"))
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
        .And(Expression.Property("name").Like(Expression.String("Royal Eng____rs Museum"))))
    .Limit(Expression.Int(10))) {
    foreach (var result in query.Execute()) {
        Console.WriteLine($"Name Property :: {result.GetString("name")}");
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-regex-ops"><a class="anchor" href="#lbl-regex-ops"></a>Regex Operator</h3>
<div class="paragraph">
<p>Similar to the wildcards in <code>like</code> expressions, <code>regex</code> based pattern matching allow you to introduce an element of fuzziness in your search string.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong> though, that the <code>regex</code> operator is case sensitive.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more on the regex spec used by {cbl} see <a href="http://www.cplusplus.com/reference/regex/ECMAScript/" target="_blank" rel="noopener">cplusplus regex reference page</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The code shown in <a href="#ex-regex">Example 8</a> executes a query that will return documents of type "landmark" with a name matching "Engine", "engine" and so on.</p>
</div>
<div id="ex-regex" class="exampleblock">
<div class="title">Example 8. Using Regular Expressions</div>
<div class="content">
<div class="paragraph">
<p>This example returns documents with a <code>type</code> of "landmark" and a <code>name</code> property that matches any string that begins with "eng" and ends in the letter "e".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L757-L767">using (var query = QueryBuilder.Select(
        SelectResult.Expression(Meta.ID),
        SelectResult.Property("name"))
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
        .And(Expression.Property("name").Regex(Expression.String("\\bEng.*e\\b"))))
    .Limit(Expression.Int(10))) {
    foreach (var result in query.Execute()) {
        Console.WriteLine($"Name Property :: {result.GetString("name")}");
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>\b</code> specifies that the match must occur on word boundaries.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-deleted-ops"><a class="anchor" href="#lbl-deleted-ops"></a>Deleted Document</h3>
<div class="paragraph">
<p>You can query documents that have been deleted (tombstones)
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.</p>
</div>
<div id="ex-del-qry" class="exampleblock">
<div class="title">Example 9. Query to select Deleted Documents</div>
<div class="content">
<div class="paragraph">
<p>This example shows how to query deleted documents in the database.
The result set it returns is an array of key-value pairs.
One for each document matching the criteria&#8201;&#8212;&#8201;see <a href="#lbl-id-sel">Select Document Id Only</a> for how to work with this result set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">// Query documents that have been deleted
var query = QueryBuilder
    .Select(SelectResult.Expression(Meta.ID))
    .From(DataSource.Database(db))
    .Where(Meta.IsDeleted);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-join"><a class="anchor" href="#lbl-join"></a>JOIN statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JOIN clause enables you to select data from multiple documents that have been linked by criteria specified in the JOIN statement. For example to combine airline details with route details, linked by the airline id&#8201;&#8212;&#8201;see <a href="#ex-join">Example 10</a>.</p>
</div>
<div id="ex-join" class="exampleblock">
<div class="title">Example 10. Using JOIN to Combine Document Details</div>
<div class="content">
<div class="paragraph">
<p>This example JOINS the document of type <code>route</code> with documents of type <code>airline</code> using the document ID (<code><em>id</code>) on the _airline</em> document and <code>airlineid</code> on the <em>route</em> document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L777-L792">using (var query = QueryBuilder.Select(
        SelectResult.Expression(Expression.Property("name").From("airline")),
        SelectResult.Expression(Expression.Property("callsign").From("airline")),
        SelectResult.Expression(Expression.Property("destinationairport").From("route")),
        SelectResult.Expression(Expression.Property("stops").From("route")),
        SelectResult.Expression(Expression.Property("airline").From("route")))
    .From(DataSource.Database(db).As("airline"))
    .Join(Join.InnerJoin(DataSource.Database(db).As("route"))
        .On(Meta.ID.From("airline").EqualTo(Expression.Property("airlineid").From("route"))))
    .Where(Expression.Property("type").From("route").EqualTo(Expression.String("route"))
        .And(Expression.Property("type").From("airline").EqualTo(Expression.String("airline")))
        .And(Expression.Property("sourceairport").From("route").EqualTo(Expression.String("RIX"))))) {
    foreach (var result in query.Execute()) {
        Console.WriteLine($"Name Property :: {result.GetString("name")}");
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-group"><a class="anchor" href="#lbl-group"></a>GROUP BY statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can perform further processing on the data in your result set before the final projection is generated.
The following example looks for the number of airports at an altitude of 300 ft or higher and groups the results by country and timezone.</p>
</div>
<div class="listingblock">
<div class="title">Data Model for Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "_id": "airport123",
    "type": "airport",
    "country": "United States",
    "geo": { "alt": 456 },
    "tz": "America/Anchorage"
}</code></pre>
</div>
</div>
<div id="ex-grpby-qry" class="exampleblock">
<div class="title">Example 11. Query using GroupBy</div>
<div class="content">
<div class="paragraph">
<p>This example shows a query that selects all airports with an altitude above 300ft.
The output (a count, $1) is grouped by country, within timezone.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L802-L814">using (var query = QueryBuilder.Select(
        SelectResult.Expression(Function.Count(Expression.All())),
        SelectResult.Property("country"),
        SelectResult.Property("tz"))
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").EqualTo(Expression.String("airport"))
        .And(Expression.Property("geo.alt").GreaterThanOrEqualTo(Expression.Int(300))))
    .GroupBy(Expression.Property("country"), Expression.Property("tz"))) {
    foreach (var result in query.Execute()) {
        Console.WriteLine(
            $"There are {result.GetInt("$1")} airports in the {result.GetString("tz")} timezone located in {result.GetString("country")} and above 300 ft");
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The query shown in <a href="#ex-grpby-qry">Example 11</a> generates the following output:</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>There are 138 airports on the Europe/Paris timezone located in France and above 300 ft<br>
There are 29 airports on the Europe/London timezone located in United Kingdom and above 300 ft<br>
There are 50 airports on the America/Anchorage timezone located in United States and above 300 ft<br>
There are 279 airports on the America/Chicago timezone located in United States and above 300 ft<br>
There are 123 airports on the America/Denver timezone located in United States and above 300 ft</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-order"><a class="anchor" href="#lbl-order"></a>ORDER BY statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to sort the results of a query based on a given expression result.
The example below returns documents of type equal to "hotel" sorted in ascending order by the value of the title property.</p>
</div>
<div id="ex-orderby-qry" class="exampleblock">
<div class="title">Example 12. Query using OrderBy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L824-L834">using (var query = QueryBuilder.Select(
        SelectResult.Expression(Meta.ID),
        SelectResult.Property("title"))
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
    .OrderBy(Ordering.Property("title").Ascending())
    .Limit(Expression.Int(10))) {
    foreach (var result in query.Execute()) {
        Console.WriteLine($"Title :: {result.GetString("title")}");
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The query shown in <a href="#ex-orderby-qry">Example 12</a> generates the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Aberdyfi
Achiltibuie
Altrincham
Ambleside
Annan
Ardèche
Armagh
Avignon</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-date-time"><a class="anchor" href="#lbl-date-time"></a>Date/Time Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite documents support a <a href="#initializers">date type</a> that internally stores dates in ISO 8601 with the GMT/UTC timezone.</p>
</div>
<div class="paragraph">
<p>Couchbase Lite 2.5 adds the ability to run date comparisons in your Couchbase Lite queries.
To do so, four functions have been added to the Query Builder API:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Function.StringToMillis(Expression.Property("date_time"))</code></dt>
<dd>
<p>The input to this will be a validly formatted ISO 8601 <code>date_time</code> string.
The end result will be an expression (with a numeric content) that can be further input into the query builder.</p>
</dd>
<dt class="hdlist1"><code>Function.StringToUTC(Expression.Property("date_time"))</code></dt>
<dd>
<p>The input to this will be a validly formatted ISO 8601 <code>date_time</code> string.
The end result will be an expression (with string content) that can be further input into the query builder.</p>
</dd>
<dt class="hdlist1"><code>Function.MillisToString(Expression.Property("date_time"))</code></dt>
<dd>
<p>The input for this is a numeric value representing milliseconds since the Unix epoch.
The end result will be an expression (with string content representing the date and time as an ISO 8601 string in the device’s timezone) that can be further input into the query builder.</p>
</dd>
<dt class="hdlist1"><code>Function.MillisToUTC(Expression.Property("date_time"))</code></dt>
<dd>
<p>The input for this is a numeric value representing milliseconds since the Unix epoch.
The end result will be an expression (with string content representing the date and time as a UTC ISO 8601 string) that can be further input into the query builder.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-resultsets"><a class="anchor" href="#lbl-resultsets"></a>Result Sets</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-process-resultset">Processing</a>&#160;&#160;|&#160;&#160;
<a href="#lbl-all-sel">Select All Properties</a>&#160;&#160;|&#160;&#160;
<a href="#lbl-specific-sel">Select Specific Properties</a>&#160;&#160;|&#160;&#160;
<a href="#lbl-id-sel">Select Document Id Only</a>&#160;&#160;|&#160;&#160;
<a href="#lbl-count-sel">Select Count-only</a>&#160;&#160;|&#160;&#160;
<a href="#lbl-pagination">Handling Pagination</a></p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="lbl-process-resultset"><a class="anchor" href="#lbl-process-resultset"></a>Processing</h3>
<div class="paragraph">
<p>This section shows how to handle the returned result sets for different types of <code>SELECT</code> statements.</p>
</div>
<div class="paragraph">
<p>The result set format and its handling varies slightly depending on the type of SelectResult statements used.
The result set formats you may encounter include those generated by :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SelectResult.all&#8201;&#8212;&#8201;see: <a href="#lbl-all-sel">All Properties</a></p>
</li>
<li>
<p>SelectResult.expression(property("name"))&#8201;&#8212;&#8201;see: <a href="#lbl-specific-sel">Specific Properties</a></p>
</li>
<li>
<p>SelectResult.expression(meta.id)&#8201;&#8212;&#8201; Metadata (such as the <code>_id</code>)&#8201;&#8212;&#8201;see: <a href="#lbl-id-sel">Document ID Only</a></p>
</li>
<li>
<p>SelectResult.expression(Function.count(Expression.all())).as("mycount")&#8201;&#8212;&#8201; see: <a href="#lbl-count-sel">Select Count-only</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To process the results of a query, you first need to execute it using <code>Query.execute</code>.</p>
</div>
<div class="paragraph">
<p>The execution of a Couchbase Lite for C#.Net&#8217;s database query typically returns an array of results, a result set.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The result set of an aggregate, count-only, query is a key-value pair&#8201;&#8212;&#8201;see <a href="#lbl-count-sel">Select Count-only</a>&#8201;&#8212;&#8201;which you can access using the count name as its key.</p>
</li>
<li>
<p>The result set of a query returning document properties is an array.<br>
Each array row represents the data from a document that matched your search criteria (the <code>WHERE</code> statements)
The composition of each row is determined by the combination of <code>SelectResult</code> expressions provided in the <code>SELECT</code> statement.
To unpack these result sets you need to iterate this array.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="lbl-all-sel"><a class="anchor" href="#lbl-all-sel"></a>Select All Properties</h3>
<div class="paragraph">
<div class="title">Query</div>
<p>The <code>Select</code> statement for this type of query, which returns all document properties for each document matching the query criteria, is fairly straightforward&#8201;&#8212;&#8201;see <a href="#ex-all-qry">Example 13</a></p>
</div>
<div id="ex-all-qry" class="exampleblock">
<div class="title">Example 13. Query selecting All Properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
              .Select(SelectResult.All())
              .From(DataSource.Database(this_Db));</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Result Set Format</div>
<p>The result set returned by queries using <code>SelectResult.all</code> is an array of dictionary objects&#8201;&#8212;&#8201;one for each document matching the query criteria.</p>
</div>
<div class="paragraph">
<p>For each result object, the key is the database name and the 'value' is a dictionary representing each document property as a key-value pair&#8201;&#8212;&#8201;see: <a href="#ex-all-rtn">Example 14</a>.</p>
</div>
<div id="ex-all-rtn" class="exampleblock">
<div class="title">Example 14. Format of Result Set (All Properties)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "travel-sample": { <i class="conum" data-value="1"></i><b>(1)</b>
      "callsign": "MILE-AIR",
      "country": "United States",
      "iata": "Q5",
      "icao": "MLA",
      "id": 10,
      "name": "40-Mile Air",
      "type": "airline"
    }
  },
  {
    "travel-sample": { <i class="conum" data-value="2"></i><b>(2)</b>
      "callsign": "ALASKAN-AIR",
      "country": "United States",
      "iata": "AA",
      "icao": "AAA",
      "id": 10,
      "name": "Alaskan Airways",
      "type": "airline"
    }
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we see the result for the first document matching the query criteria.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Here we see the result for the next document matching the query criteria.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Result Set Access</div>
<p>In this case access the retrieved document properties by converting each row&#8217;s value, in turn, to a dictionary&#8201;&#8212;&#8201;as shown in <a href="#ex-all-acc">Example 15</a>.</p>
</div>
<div id="ex-all-acc" class="exampleblock">
<div class="title">Example 15. Using Document Properties (All)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">        var results = query.Execute().AllResults();

        if (results?.Count &gt; 0)
        {
            List&lt;Dictionary&lt;string,object&gt;&gt; hotels = new List&lt;Dictionary&lt;string,object&gt;&gt;();
            foreach (var result in results)
            {
                // get the result into our dictionary object
                var thisDocsProps = result.GetDictionary(dbName); <i class="conum" data-value="1"></i><b>(1)</b>

                if (thisDocsProps != null)
                {
                    thisDocsId = thisDocsProps.GetString("id"); <i class="conum" data-value="2"></i><b>(2)</b>
                    thisDocsName = thisDocsProps.GetString("name");
                    thisDocsCity = thisDocsProps.GetString("city");
                    thisDocsType = thisDocsProps.GetString("type");
                    hotel = thisDocsProps.ToDictionary();
                    hotels.Add(hotel);
                }

            }
        }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we get the dictionary of document properties using the database name as the key.
You can add this dictionary to an array of returned matches, for processing elsewhere in the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Alternatively you can access the document properties here, by using the property names as keys to the dictionary object.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-specific-sel"><a class="anchor" href="#lbl-specific-sel"></a>Select Specific Properties</h3>
<div class="paragraph">
<div class="title">Query</div>
<p>Here we use <code>SelectResult.expression(property("&lt;property-name&gt;")))</code> to specify the document properties we want our query to return&#8201;&#8212;&#8201;see: <a href="#ex-specific-qry">Example 16</a>.</p>
</div>
<div id="ex-specific-qry" class="exampleblock">
<div class="title">Example 16. Query selecting Specific Properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">        var this_Db = new Database("hotels") ;

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();

        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var query = QueryBuilder.Select(
                SelectResult.Property("type"),
                SelectResult.Property("name"),
                SelectResult.Property("city")).From(DataSource.Database(this_Db));</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Result Set Format</div>
<p>The result set returned when selecting only specific document properties is an array of dictionary objects&#8201;&#8212;&#8201;one for each document matching the query criteria.</p>
</div>
<div class="paragraph">
<p>Each result object comprises a key-value pair for each selected document property&#8201;&#8212;&#8201;see <a href="#ex-specific-rtn">Example 17</a></p>
</div>
<div id="ex-specific-rtn" class="exampleblock">
<div class="title">Example 17. Format of Result Set (Specific Properties)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  { <i class="conum" data-value="1"></i><b>(1)</b>
    "id": "hotel123",
    "type": "hotel",
    "name": "Hotel Ghia"
  },
  { <i class="conum" data-value="2"></i><b>(2)</b>
    "id": "hotel456",
    "type": "hotel",
    "name": "Hotel Deluxe",
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we see the result for the first document matching the query criteria.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Here we see the result for the next document matching the query criteria.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Result Set Access</div>
<p>Access the retrieved properties by converting each row into a dictionary&#8201;&#8212;&#8201;as shown in <a href="#ex-specific-acc">Example 18</a>.</p>
</div>
<div id="ex-specific-acc" class="exampleblock">
<div class="title">Example 18. Using Returned Document Properties (Specific Properties)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            // get the returned array of k-v pairs into a dictionary
            hotel = result.ToDictionary();

            // add hotel dictionary to list of hotel dictionaries
            hotels.Add(hotel);

            // use the properties of the returned array of k-v pairs directly
            thisDocsType = result.GetString("type");
            thisDocsName = result.GetString("name");
            thisDocsCity = result.GetString("city");

        }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-id-sel"><a class="anchor" href="#lbl-id-sel"></a>Select Document Id Only</h3>
<div class="paragraph">
<div class="title">Query</div>
<p>You would typically use this type of query if retrieval of document properties directly would consume excessive amounts of memory and-or processing time&#8201;&#8212;&#8201;see: <a href="#ex-id-qry">Example 19</a>.</p>
</div>
<div id="ex-id-qry" class="exampleblock">
<div class="title">Example 19. Query selecting only Doc Id</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs">        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID).As("this_ID"))
                .From(DataSource.Database(this_Db));</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Result Set Format</div>
<p>The result set returned by queries using a SelectResult expression of the form <code>SelectResult.expression(meta.id)</code> is an array of dictionary objects&#8201;&#8212;&#8201;one for each document matching the query criteria.
Each result object has <code>id</code> as the key and the ID value as its value&#8201;&#8212;&#8201;-see <a href="#ex-id-rtn">Example 20</a>.</p>
</div>
<div id="ex-id-rtn" class="exampleblock">
<div class="title">Example 20. Format of Result Set (Doc Id only)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "id": "hotel123"
  },
  {
    "id": "hotel456"
  },
]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Result Set Access</div>
<p>In this case, access the required document&#8217;s properties by unpacking the <code>id</code> and using it to get the document from the database&#8201;&#8212;&#8201;see: <a href="#ex-id-acc">Example 21</a>.</p>
</div>
<div id="ex-id-acc" class="exampleblock">
<div class="title">Example 21. Using Returned Document Properties (Document Id)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            var thisDocsID = result.GetString("this_ID"); <i class="conum" data-value="1"></i><b>(1)</b>
            var doc = this_Db.GetDocument(thisDocsID);
        }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Extract the Id value from the dictionary and use it to get the document from the database</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-count-sel"><a class="anchor" href="#lbl-count-sel"></a>Select Count-only</h3>
<div id="ex-count-qry" class="exampleblock">
<div class="title">Example 22. Query selecting a Count-only</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">        var this_Db = new Database("hotels") ;

        var query =
          QueryBuilder
            .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount")) <i class="conum" data-value="1"></i><b>(1)</b>
            .From(DataSource.Database(this_Db));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The alias name, <code>mycount</code>, is used to access the count value.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Result Set Format</div>
<p>The result set returned by a count such as <code>Select.expression(Function.count(Expression.all)))</code> is a key-value pair.
The key is the count name, as defined using <code>SelectResult.as</code>&#8201;&#8212;&#8201;see: <a href="#ex-count-rtn">Example 23</a> for the format and <a href="#ex-count-qry">Example 22</a> for the query.</p>
</div>
<div id="ex-count-rtn" class="exampleblock">
<div class="title">Example 23. Format of Result Set (Count)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "mycount": 6
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we see the key-value pair returned by a count.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Result Set Access</div>
<p>Access the count using its alias name (<code>mycount</code> in this example)&#8201;&#8212;&#8201;see <a href="#ex-count-acc">Example 24</a></p>
</div>
<div id="ex-count-acc" class="exampleblock">
<div class="title">Example 24. Using Returned Document Properties (Count)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">        var results = query.Execute().AllResults();

        foreach (var result in results)
        {

            var numberOfDocs = result.GetInt("mycount"); <i class="conum" data-value="1"></i><b>(1)</b>

        }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the count using the <code>SelectResult.as</code> alias, which is used as its key.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-pagination"><a class="anchor" href="#lbl-pagination"></a>Handling Pagination</h3>
<div class="paragraph">
<p>One way to handle pagination in high-volume queries is to retrieve the results in batches.
Use the <code>limit</code> and <code>offset</code> feature, to return a defined number of results starting from a given offset&#8201;&#8212;&#8201;see: <a href="#ex-pagination">Example 25</a>.</p>
</div>
<div id="ex-pagination" class="exampleblock">
<div class="title">Example 25. Query Pagination</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/osfameron/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs">      var this_Db = new Database("hotels") ;

      var thisLimit = 20;
      var thisOffset = 0;

      // get a count of the number of docs matching the query
      var countQuery =
          QueryBuilder
              .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount"))
              .From(DataSource.Database(this_Db));
      var numberOfDocs =
          countQuery.Execute().AllResults().ElementAt(0).GetInt("mycount");

      if (numberOfDocs &lt; thisLimit) {
          thisLimit = numberOfDocs;
      }

      while (thisOffset &lt; numberOfDocs)
      {
          var listQuery =
              QueryBuilder
                  .Select(SelectResult.All())
                  .From(DataSource.Database(this_Db))
                  .Limit(Expression.Int(thisLimit), Expression.Int(thisOffset)); <i class="conum" data-value="1"></i><b>(1)</b>

          foreach (var result in listQuery.Execute().AllResults())
          {
              // Display and or process query results batch

          }

          thisOffset = thisOffset + thisLimit;

      } // end while</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Return a maximum of <code>limit</code> results starting from result number <code>offset</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more on using the QueryBuilder API, see our blog: <a href="https://blog.couchbase.com/sql-for-json-query-interface-couchbase-mobile/" target="_blank" rel="noopener">Introducing the Query Interface in Couchbase Mobile</a>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id=""><a class="anchor" href="#"></a></h6>
<div class="ulist">
<div class="title">How to . . .</div>
<ul>
<li>
<p><a href="gs-install.html" class="xref page">Prerequisites</a></p>
</li>
<li>
<p><a href="gs-install.html" class="xref page">Install</a></p>
</li>
<li>
<p><a href="gs-build.html" class="xref page">Build and Run</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">Learn more . . .</div>
<ul>
<li>
<p><a href="database.html" class="xref page">Databases</a></p>
</li>
<li>
<p><a href="document.html" class="xref page">Documents</a></p>
</li>
<li>
<p><a href="blob.html" class="xref page">Blobs</a></p>
</li>
<li>
<p><a href="replication.html" class="xref page">Remote Sync using Sync Gateway</a></p>
</li>
<li>
<p><a href="conflict.html" class="xref page">Handling Data Conflicts</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="paragraph">
<div class="title">Dive Deeper . . .</div>
<p>Unresolved include directive in modules/ROOT/pages/_partials/_related-content.adoc - include::shared-mobile::partial$_related-content.adoc[]</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Starting in Couchbase Lite 2.5
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Mobile","components":["couchbase-lite"],"url":"/home/mobile.html","latestVersions":{"couchbase-lite":"2.8"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
