<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Documents | Couchbase Capella Staging Docs</title>
<link rel="canonical" href="https://docs.stage.nonprod-project-avengers.com/couchbase-lite/3.0/c/document.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Couchbase Lite concepts -- Data model -- Documents">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="couchbase-lite">
<meta name="dcterms.identifier" content="3.0">
<meta name="page-url" content="/couchbase-lite/3.0/c/document.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.stage.nonprod-project-avengers.com/cloud/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.stage.nonprod-project-avengers.com/cloud/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="2@">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/pages/document.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">Couchbase Lite</a></li>
<li class="crumb"><a href="quickstart.html">C</a></li>
<li class="crumb"><a href="document.html">Documents</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Documents</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Description&#8201;&#8212;&#8201;<em>Couchbase Lite concepts&#8201;&#8212;&#8201;Data model&#8201;&#8212;&#8201;Documents</em><br>
Related Content&#8201;&#8212;&#8201;<a href="database.html" class="xref page">Databases</a> | <a href="blob.html" class="xref page">Blobs</a> | <a href="indexing.html" class="xref page">Indexing</a> |</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="document-structure"><a class="anchor" href="#document-structure"></a>Document Structure</h3>
<div class="paragraph">
<p>In <em>Couchbase&#160;Lite</em> the term 'document' refers to an entry in the database; a record, or row in a table if you like.</p>
</div>
<div class="paragraph">
<p>Each document has an ID (primary key in other databases) by which it can be located.
This ID can be automatically generated (as a UUID) or specified programmatically;
the only constraints are that it must be unique within the database, and it can&#8217;t be changed.
The document also has a value which contains the actual application data.
This value is stored as a dictionary collection of key-value (k-v) pairs where the values themselves may comprise different types of data such as numbers, strings, arrays or even nested objects&#8201;&#8212;&#8201;see: <a href="#data-types">Data Types</a></p>
</div>
</div>
<div class="sect2">
<h3 id="data-encoding"><a class="anchor" href="#data-encoding"></a>Data Encoding</h3>
<div class="paragraph">
<p>The document body is stored in an internal, efficient, binary form (
<a href="https://github.com/couchbaselabs/fleece#readme">Fleece</a>
).<br>
This internal form is easily converted into a manageable native dictionary format for manipulation in applications.</p>
</div>
<div class="paragraph">
<p>Fleece data is stored in the smallest format that will hold the value, whilst maintaining the integrity of the value.</p>
</div>
</div>
<div class="sect2">
<h3 id="data-types"><a class="anchor" href="#data-types"></a>Data Types</h3>
<div class="paragraph">
<p>The <code>Document</code> class offers a set of property accessors for various scalar types, including boolean, integers, floating-point and strings.
These accessors take care of converting to/from JSON encoding, and make sure you get the type you&#8217;re expecting.</p>
</div>
<div class="paragraph">
<p>So your document content may well comprise one or more supporting data types such as:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Boolean</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Date</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Double</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Float</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to these basic data types Couchbase Lite provides for the following:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Dictionary&#8201;&#8212;&#8201;represents a read-only key-value pair collection</p>
</li>
<li>
<p>MutableDictionary&#8201;&#8212;&#8201;represents a writeable key-value pair collection</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Array&#8201;&#8212;&#8201;represents a readonly ordered collection of objects</p>
</li>
<li>
<p>MutableArray&#8201;&#8212;&#8201;represents a writeable collection of objects</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Blob&#8201;&#8212;&#8201;represents an arbitrary piece of binary data</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="json"><a class="anchor" href="#json"></a>JSON</h3>
<div class="paragraph">
<p>Couchbase Lite also provides for the direct handling of JSON data implemented in most cases by the provision of a <code>toJSON()</code> method on appropriate API classes (for example, on MutableDocument, Dictionary, Blob and Array)&#8201;&#8212;&#8201;see <a href="#lbl-json-data">Working with JSON Data</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="constructing-a-document"><a class="anchor" href="#constructing-a-document"></a>Constructing a Document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An individual document often represents a single instance of an object in application code.
A document might be considered equivalent to a row in a relational table; with each of the document’s attributes being equivalent to a column.</p>
</div>
<div class="paragraph">
<p>Documents can contain nested structures.
This allows developers to express many-to-many relationships without requiring a reference or junction table; and is naturally expressive of hierarchical data.</p>
</div>
<div class="paragraph">
<p>Most apps will work with one or more documents, persisting them to a local database and optionally syncing them, either centrally or to the cloud.</p>
</div>
<div class="paragraph">
<p>In this section we provide an example of how you might create a <code>hotel</code> document, which provides basic contact details and price data.</p>
</div>
<div class="listingblock">
<div class="title">Data Model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">hotel: {
  type: string (value = `hotel`)
  name: string
  address: dictionary {
    street: string
    city: string
    state: string
    country: string
    code: string
  }
  phones: array
  rate: float
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="ex-usage"><a class="anchor" href="#ex-usage"></a>Open a Database</h3>
<div class="paragraph">
<p>First we open your database.
If the database does not already exist, Couchbase Lite will create it for us.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// Open or create DB if it doesn't exist
CBLError err;
CBLDatabase* database = CBLDatabase_Open(FLSTR("mydb"), NULL, &amp;err);
if(!database) {
    // Error handling.  For brevity, this is truncated in the rest of the snippet
    // and omitted in other doc code snippets
    fprintf(stderr, "Error opening database (%d / %d)\n", err.domain, err.code);
    FLSliceResult msg = CBLError_Message(&amp;err);
    fprintf(stderr, "%.*s\n", (int)msg.size, (const char *)msg.buf);
    FLSliceResult_Release(msg);
    return;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See: <a href="database.html" class="xref page">Databases</a> for more information</p>
</div>
</div>
<div class="sect2">
<h3 id="create-a-document"><a class="anchor" href="#create-a-document"></a>Create a Document</h3>
<div class="paragraph">
<p>Now we create a new document to hold our application&#8217;s data.</p>
</div>
<div class="paragraph">
<p>Because we will be adding data to the document we must use its mutable form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// Create your new document
// The lack of 'const' indicates this document is mutable
CBLDocument* mutableDoc = CBLDocument_Create();
FLMutableDict properties = CBLDocument_MutableProperties(mutableDoc);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more on using <strong>Documents</strong>, see: <a href="#document-initializers">Document Initializers</a> and <a href="#mutability">Mutability</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-a-dictionary"><a class="anchor" href="#create-a-dictionary"></a>Create a Dictionary</h3>
<div class="paragraph">
<p>Here we create a dictionary (<code>address</code>).
Because we want to add values into the dictionary, we must create it in <em>mutable</em> form.</p>
</div>
<div class="paragraph">
<p>When the dictionary is retrieved, each element&#8217;s value is directly accessible via its own key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// Create and populate mutable dictionary
FLMutableDict address = FLMutableDict_New();
FLMutableDict_SetString(address, FLSTR("street"), FLSTR("1 Main st."));
FLMutableDict_SetString(address, FLSTR("city"), FLSTR("San Francisco"));
FLMutableDict_SetString(address, FLSTR("state"), FLSTR("CA"));
FLMutableDict_SetString(address, FLSTR("country"), FLSTR("USA"));
FLMutableDict_SetString(address, FLSTR("code"), FLSTR("90210"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more on using <strong>Dictionaries</strong>, see: <a href="#using-dictionaries">Using Dictionaries</a></p>
</div>
</div>
<div class="sect2">
<h3 id="create-an-array"><a class="anchor" href="#create-an-array"></a>Create an Array</h3>
<div class="paragraph">
<p>Since our hotel may have multiple lines we provide an array (<code>phones</code>) to hold contact numbers.
Again, because we want to add values into the array, we create it in <em>mutable</em> form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// Create and populate mutable array
FLMutableArray phones = FLMutableArray_New();
FLMutableArray_AppendString(phones, FLSTR("650-000-0000"));
FLMutableArray_AppendString(phones, FLSTR("650-000-0001"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more on using <strong>Arrays</strong>, see: <a href="#using-arrays">Using Arrays</a></p>
</div>
</div>
<div class="sect2">
<h3 id="populate-a-document"><a class="anchor" href="#populate-a-document"></a>Populate a Document</h3>
<div class="paragraph">
<p>Here we add our data to the mutable document we created earlier. Each data item is stored as a key-value pair.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// Initialize and populate the document

// Add document type to document properties <i class="conum" data-value="1"></i><b>(1)</b>
FLMutableDict_SetString(properties, FLSTR("type"), FLSTR("hotel"));

// Add hotel name string to document properties <i class="conum" data-value="2"></i><b>(2)</b>
FLMutableDict_SetString(properties, FLSTR("hotel"), FLSTR(""));

// Add float to document properties <i class="conum" data-value="3"></i><b>(3)</b>
FLMutableDict_SetFloat(properties, FLSTR("room_rate"), 121.75f);

// Add dictionary to document's properties <i class="conum" data-value="4"></i><b>(4)</b>
FLMutableDict_SetDict(properties, FLSTR("address"), dict);

// Add array to document's properties <i class="conum" data-value="5"></i><b>(5)</b>
FLMutableDict_SetArray(properties, FLSTR("phones"), phones);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add hotel name (string)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add average room rate (float)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add document type (string)<br>
Couchbase recommend using a <code>type</code> attribute to define each logical document type.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add address (dictionary)
The <code>address</code> dictionary is added to the document and stored with the key <code>address</code>. We will use this to retrieve it when needed.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add phone numbers (array)
The <code>phones</code> arrary is added to the document and stored with the key <code>phones</code>. We will use this to retrieve it when needed.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="save-a-document"><a class="anchor" href="#save-a-document"></a>Save a Document</h3>
<div class="paragraph">
<p>With the document now populated, we can persist to our Couchbase Lite database, auto-generating the document id.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// Save the document changes <i class="conum" data-value="1"></i><b>(1)</b>
CBLError err;
CBLDatabase_SaveDocument(database, doc, &amp;err);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="close-the-database"><a class="anchor" href="#close-the-database"></a>Close the Database</h3>
<div class="paragraph">
<p>With our document saved, we can now close our Couchbase Lite database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// Close the database <i class="conum" data-value="1"></i><b>(1)</b>
CBLError err;
CBLDatabase_Close(database, &amp;err);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="release-resources"><a class="anchor" href="#release-resources"></a>Release resources</h3>
<div class="paragraph">
<p>Now we have finished and can release the resources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// Release the created items <i class="conum" data-value="1"></i><b>(1)</b>
CBLDatabase_Release(database);
CBLDocument_Release(doc);
FLMutableDict_Release(dict);
FLMutableArray_Release(phones);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="working-with-data"><a class="anchor" href="#working-with-data"></a>Working with Data</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="using-dictionaries"><a class="anchor" href="#using-dictionaries"></a>Using Dictionaries</h3>
<div class="ulist">
<div class="title">API References</div>
<ul>
<li>
<p><a href="http://docs.couchbase.com/mobile/3.0.2/couchbase-lite-c/C/html/group__f_l_dict.html">Fleece Dictionaries</a></p>
</li>
</ul>
</div>
<div id="ex-dict" class="exampleblock">
<div class="title">Example 1. Read Only</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// NOTE: No error handling, for brevity (see getting started)

CBLError err;
const CBLDocument *doc = CBLDatabase_GetDocument(db, FLSTR("doc1"), &amp;err);
FLDict properties = CBLDocument_Properties(doc);

// Getting a dictionary from the document's properties
FLValue dictValue = FLDict_Get(properties, FLSTR("address"));
FLDict dict = FLValue_AsDict(dictValue);

// Access a value with a key from the dictionary
FLValue streetVal = FLDict_Get(dict, FLSTR("street"));
FLString street = FLValue_AsString(streetVal);

// Iterate dictionary
FLDictIterator iter;
FLDictIterator_Begin(dict, &amp;iter);
FLValue value;
while (NULL != (value = FLDictIterator_GetValue(&amp;iter))) {
    FLString key = FLDictIterator_GetKeyString(&amp;iter);
    FLString strValue = FLValue_AsString(value);
    printf("Key :: %.*s\n", (int)key.size, (const char *)key.buf);
    printf("Value :: %.*s\n", (int)strValue.size, (const char *)strValue.buf);
    // ...
    FLDictIterator_Next(&amp;iter);
}

// Create a mutable copy.
// kFLDefaultCopy is shallow which means the nested dictionaries and arrays will be
// referenced but not copied. Use kFLDeepCopyImmutables for the deep copy.
FLMutableDict mutableDict = FLDict_MutableCopy(dict, kFLDefaultCopy);

// Release when finish using it
FLMutableDict_Release(mutableDict);</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-mutdict" class="exampleblock">
<div class="title">Example 2. Mutable</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// NOTE: No error handling, for brevity (see getting started)

// Create a new mutable dictionary and populate some keys/values
FLMutableDict dict = FLMutableDict_New();
FLMutableDict_SetString(dict, FLSTR("street"), FLSTR("1 Main st."));
FLMutableDict_SetString(dict, FLSTR("city"), FLSTR("San Francisco"));

// Set the dictionary to document's properties and save the document
CBLDocument *doc = CBLDocument_Create();
FLMutableDict properties = CBLDocument_MutableProperties(doc);
FLMutableDict_SetDict(properties, FLSTR("address"), dict);
CBLError err;
CBLDatabase_SaveDocument(db, doc, &amp;err);
CBLDocument_Release(doc);

// Release when finish using it
FLMutableDict_Release(dict);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-arrays"><a class="anchor" href="#using-arrays"></a>Using Arrays</h3>
<div class="ulist">
<div class="title">API References</div>
<ul>
<li>
<p><a href="http://docs.couchbase.com/mobile/3.0.2/couchbase-lite-c/C/html/group__f_l_array.html">Fleece Arrays</a></p>
</li>
<li>
<p></p>
</li>
</ul>
</div>
<div id="ex-array" class="exampleblock">
<div class="title">Example 3. Read Only</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// NOTE: No error handling, for brevity (see getting started)

CBLError err;
const CBLDocument *doc = CBLDatabase_GetDocument(db, FLSTR("doc1"), &amp;err);
FLDict properties = CBLDocument_Properties(doc);

// Getting a phones array from the document's properties
FLValue arrayValue = FLDict_Get(properties, FLSTR("phones"));
FLArray array = FLValue_AsArray(arrayValue);

// Get element count
int count = FLArray_Count(array);
printf("Count :: %d\n", count);

// Access an array element by index
if (!FLArray_IsEmpty(array)) {
    FLValue phoneVal = FLArray_Get(array, 0);
    FLString phone = FLValue_AsString(phoneVal);
    printf("Value :: %.*s\n", (int)phone.size, (const char *)phone.buf);
}

// Iterate array
FLArrayIterator iter;
FLArrayIterator_Begin(array, &amp;iter);
FLValue val;
while (NULL != (val = FLArrayIterator_GetValue(&amp;iter)))
{
    FLString str = FLValue_AsString(val);
    printf("Value :: %.*s\n", (int)str.size, (const char *)str.buf);
    FLArrayIterator_Next(&amp;iter);
}</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-mutarray" class="exampleblock">
<div class="title">Example 4. Mutable</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// NOTE: No error handling, for brevity (see getting started)

// Create a new mutable array and populate data into the array
FLMutableArray phones = FLMutableArray_New();
FLMutableArray_AppendString(phones, FLSTR("650-000-0000"));
FLMutableArray_AppendString(phones, FLSTR("650-000-0001"));

// Set the array to document's properties and save the document
CBLDocument *doc = CBLDocument_Create();
FLMutableDict properties = CBLDocument_MutableProperties(doc);
FLMutableDict_SetArray(properties, FLSTR("phones"), phones);
CBLError err;
CBLDatabase_SaveDocument(db, doc, &amp;err);
CBLDocument_Release(doc);

// Release the created dictionary
FLMutableArray_Release(phones);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-blobs"><a class="anchor" href="#using-blobs"></a>Using Blobs</h3>
<div class="paragraph">
<p>For more on working with blobs&#8201;&#8212;&#8201;see <a href="blob.html" class="xref page">Blobs</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-initializers"><a class="anchor" href="#document-initializers"></a>Document Initializers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following methods/initializers can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="http://docs.couchbase.com/mobile/3.0.2/couchbase-lite-c/C/html/group__documents.html#ga226f555fffb7543558048af20b18b737">CBLDocument_Create()</a> initializer can be used to create a new document where the document ID is randomly generated by the database.</p>
</li>
<li>
<p>The <a href="http://docs.couchbase.com/mobile/3.0.2/couchbase-lite-c/C/html/group__documents.html#gaec41cf2eab4e3ac490f11007f665a35e">CBLDocument_CreateWithID()</a> initializer can be used to create a new document with a specific ID.</p>
</li>
<li>
<p>The <a href="http://docs.couchbase.com/mobile/3.0.2/couchbase-lite-c/C/html/group__documents.html#ga214b7d6c7d58bde09de10f1ed418a16b">CBLDatabase_GetDocument()</a> method can be used to get a document.
If it doesn&#8217;t exist in the database, it will return <code>null</code>.
This method can be used to check if a document with a given ID already exists in the database.</p>
</li>
</ul>
</div>
<div id="ex-persists-doc" class="exampleblock">
<div class="title">Example 5. Persist a document</div>
<div class="content">
<div class="paragraph">
<p>The following code example creates a document and persists it to the database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// NOTE: No error handling, for brevity (see getting started)

CBLDocument* newTask = CBLDocument_CreateWithID(FLSTR("xyz"));
FLMutableDict properties = CBLDocument_MutableProperties(newTask);
FLMutableDict_SetString(properties, FLSTR("type"), FLSTR("task"));
FLMutableDict_SetString(properties, FLSTR("owner"), FLSTR("todo"));

// Storing time in millisecond, bluntly
FLMutableDict_SetUInt(properties, FLSTR("createdAt"), time(NULL) * 1000);

CBLError err;
CBLDatabase_SaveDocument(db, newTask, &amp;err);
CBLDocument_Release(newTask);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mutability"><a class="anchor" href="#mutability"></a>Mutability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite for C&#8217;s document objects <code>CBLDocument*</code> can be either mutable or immutable.
Reference an immutable document using a <code>const</code> pointer and a mutable document using a non-const pointer to prevent developers from accidentally calling a mutable-document function on an immutable document.</p>
</div>
<div class="paragraph">
<p>To make an immutable document mutable, you need to use <a href="http://docs.couchbase.com/mobile/3.0.2/couchbase-lite-c/C/html/group__documents.html#ga0356b98d2f1798adc8f549510d3eef67">CBLDocument_MutableCopy()</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">CBLDocument* CBLDocument_MutableCopy(const CBLDocument* doc _cbl_nonnull)
_cbl_warn_unused _cbl_returns_nonnull;</code></pre>
</div>
</div>
<div id="ex-update-doc" class="exampleblock">
<div class="title">Example 6. Make a mutable document</div>
<div class="content">
<div class="paragraph">
<p>Changes to the document are persisted to the database when the <code>save</code> method is called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// NOTE: No error handling, for brevity (see getting started)

CBLError err;
CBLDocument* mutableDocument = CBLDatabase_GetMutableDocument(db, FLSTR("xyz"), &amp;err);
FLMutableDict properties = CBLDocument_MutableProperties(mutableDocument);
FLMutableDict_SetString(properties, FLSTR("name"), FLSTR("apples"));
CBLDatabase_SaveDocument(db, mutableDocument, &amp;err);
CBLDocument_Release(mutableDocument);</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Any user change to the value of reserved keys (<code>_id</code>, <code>_rev</code> or <code>_deleted</code>) will be detected when a document is saved and will result in an exception (Error Code 5&#8201;&#8212;&#8201;<code>CorruptRevisionData</code>)&#8201;&#8212;&#8201;see also <a href="#lbl-doc-constraints">Document Constraints</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch-operations"><a class="anchor" href="#batch-operations"></a>Batch operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;re making multiple changes to a database at once, it&#8217;s faster to group them together.
The following example persists a few documents in batch.</p>
</div>
<div id="ex-batch-ops" class="exampleblock">
<div class="title">Example 7. Batch operations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// NOTE: No error handling, for brevity (see getting started)

CBLError err;
CBLDatabase_BeginTransaction(db, &amp;err);
char buffer[7];
for(int i = 0; i &lt; 10; i++) {
    CBLDocument* doc = CBLDocument_Create();
    FLMutableDict properties = CBLDocument_MutableProperties(doc);
    FLMutableDict_SetString(properties, FLSTR("type"), FLSTR("user"));
    sprintf(buffer, "user %d", i);
    FLMutableDict_SetString(properties, FLSTR("name"), FLStr(buffer));
    FLMutableDict_SetBool(properties, FLSTR("admin"), false);
    CBLDatabase_SaveDocument(db, doc, &amp;err);
    CBLDocument_Release(doc);
    printf("Saved user document %s\n", buffer);
}

CBLDatabase_EndTransaction(db, true, &amp;err);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At the <strong>local</strong> level this operation is still transactional: no other <code>Database</code> instances, including ones managed by the replicator can make changes during the execution of the block, and other instances will not see partial changes.
But Couchbase Mobile is a distributed system, and due to the way replication works, there&#8217;s no guarantee that Sync Gateway or other devices will receive your changes all at once.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-change-events"><a class="anchor" href="#document-change-events"></a>Document change events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to register for document changes.
The following example registers for changes to the document with ID <code>user.john</code> and prints the <code>verified_account</code> property when a change is detected.</p>
</div>
<div id="ex-doc-events" class="exampleblock">
<div class="title">Example 8. Document change events</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">/*
static void document_listener(void* context, const CBLDatabase* db, FLString id) {
    CBLError err;
    const CBLDocument* doc = CBLDatabase_GetDocument(db, id, &amp;err);
    FLDict properties = CBLDocument_Properties(doc);
    FLString verified_account = FLValue_AsString(FLDict_Get(properties, FLSTR("verified_account")));
    printf("Status :: %.<strong>s\n", (int)verified_account.size, (const char *)verified_account.buf);
    CBLDocument_Release(doc);
}
*/
CBLListenerToken</strong> token = CBLDatabase_AddDocumentChangeListener(db, FLSTR("user.john"),
    document_listener, NULL);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-expiration"><a class="anchor" href="#document-expiration"></a>Document Expiration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Document expiration allows users to set the expiration date for a document.
When the document expires, it is purged from the database.
The purge is not replicated to Sync Gateway.</p>
</div>
<div id="ex-set-doc-exp" class="exampleblock">
<div class="title">Example 9. Set document expiration</div>
<div class="content">
<div class="paragraph">
<p>This example sets the TTL for a document to 5 minutes from the current time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// Purge the document one day from now

// Overly simplistic for example purposes
// NOTE: API takes milliseconds
// NOTE: No error handling, for brevity (see getting started)
time_t ttl = time(NULL) + 24 * 60 * 60;
ttl <strong>= 1000;

CBLError err;
CBLDatabase_SetDocumentExpiration(db, FLSTR("doc123"), ttl, &amp;err);

// Reset expiration
CBLDatabase_SetDocumentExpiration(db, FLSTR("doc1"), 0, &amp;err);

// Query documents that will be expired in less than five minutes
time_t fiveMinutesFromNow = time(NULL) + 5 * 60;
fiveMinutesFromNow *= 1000;
FLMutableDict parameters = FLMutableDict_New();
FLMutableDict_SetInt(parameters, FLSTR("five_minutes"), fiveMinutesFromNow);

CBLQuery</strong> query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
    FLSTR("SELECT meta().id FROM _ WHERE meta().expiration &lt; $five_minutes"), NULL, &amp;err);
CBLQuery_SetParameters(query, parameters);
FLMutableDict_Release(parameters);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-doc-constraints"><a class="anchor" href="#lbl-doc-constraints"></a>Document Constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite APIs do not explicitly disallow the use of attributes with the underscore prefix at the top level of document.
This is to facilitate the creation of documents for use either in <em>local only</em> mode where documents are not synced, or when used exclusively in peer-to-peer sync.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
"_id", :"_rev" and "_sequence" are reserved keywords and must not be used as top-level attributes&#8201;&#8212;&#8201;see <a href="#res-keys">Example 10</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Users are cautioned that any attempt to sync such documents to Sync Gateway will result in an error.
To be future proof, you are advised to avoid creating such documents.
Use of these attributes for user-level data may result in undefined system behavior.</p>
</div>
<div class="paragraph">
<p>For more guidance&#8201;&#8212;&#8201;see: <a href="#sync-gateway:ROOT:data-modeling.adoc" class="xref unresolved">Sync Gateway - data modeling guidelines</a></p>
</div>
<div id="res-keys" class="exampleblock">
<div class="title">Example 10. Reserved Keys List</div>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>_attachments</p>
</li>
<li>
<p>_deleted <sup class="footnote" id="_footnote_fn1">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p>_id <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p>_removed</p>
</li>
<li>
<p>_rev <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p>_sequence</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-json-data"><a class="anchor" href="#lbl-json-data"></a>Working with JSON Data</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-array">Arrays</a>
| <a href="#lbl-dictionary">Dictionaries</a>
| <a href="#lbl-document">Documents</a>
| <a href="#lbl-result">Query Results as JSON</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>toJSON()</code> typed-accessor means you can easily work with JSON data, native and Couchbase Lite objects.</p>
</div>
<div class="sect2">
<h3 id="lbl-array"><a class="anchor" href="#lbl-array"></a>Arrays</h3>
<div class="paragraph">
<p>Convert an <code>ArrayObject</code> to and from JSON using the <code>toJSON()</code> and <code>toArray</code> methods&#8201;&#8212;&#8201;see: <a href="#ex-array">Example 3</a>.</p>
</div>
<div class="paragraph">
<p>Additionally you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialize a 'MutableArrayObject' using data supplied as a JSON string.
This is done using the <code>init(json)</code> constructor-- see: <a href="#ex-array">Example 3</a></p>
</li>
<li>
<p>Convert an <code>ArrayFragment</code> object to a JSON String</p>
</li>
<li>
<p>Set data with a JSON string using <code>setJSON()</code></p>
</li>
</ul>
</div>
<div id="ex-array" class="exampleblock">
<div class="title">Example 11. Arrays as JSON strings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// NOTE: No error handling, for brevity (see getting started)

FLString json = FLSTR("[\"Hotel Ned\", \"Hotel Ted\"]");

// Create an array from the JSON string
FLError err;
FLSliceResult jsonData1 = FLData_ConvertJSON(json, &amp;err);
FLArray hotels = FLValue_AsArray(FLValue_FromData(FLSliceResult_AsSlice(jsonData1), kFLTrusted));

// Iterate through the array
FLArrayIterator iter;
FLArrayIterator_Begin(hotels, &amp;iter);
FLValue value;
while (NULL != (value = FLArrayIterator_GetValue(&amp;iter))) {
    FLString hotel = FLValue_AsString(value);
    printf("Hotel :: %.*s\n", (int)hotel.size, (const char *)hotel.buf);
    FLArrayIterator_Next(&amp;iter);
}

// Convert the array to JSON
FLSliceResult jsonData2 = FLValue_ToJSON((FLValue)hotels);
printf("Hotels in JSON :: %.*s\n", (int)jsonData2.size, (const char *)jsonData2.buf);

// Release JSON data after finish using it
FLSliceResult_Release(jsonData1);
FLSliceResult_Release(jsonData2);</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialize array with JSON string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create and save new document using the array</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get native array object from new doc and print its elements</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Get an array from the document as a JSON string</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-dictionary"><a class="anchor" href="#lbl-dictionary"></a>Dictionaries</h3>
<div class="paragraph">
<p>Convert a <code>DictionaryObject</code> to and from JSON using the <code>toJSON</code> and <code>toDictionary</code> methods&#8201;&#8212;&#8201;see <a href="#ex-dictionary">Example 12</a>.</p>
</div>
<div class="paragraph">
<p>Additionally you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialize a 'MutableDictionaryObject' using data supplied as a JSON string.
This is done using the <code>init(json)</code> constructor-- see: <a href="#ex-dictionary">Example 12</a></p>
</li>
<li>
<p>Set data with a JSON string using <code>setJSON()</code></p>
</li>
</ul>
</div>
<div id="ex-dictionary" class="exampleblock">
<div class="title">Example 12. Dictionaries as JSON strings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// NOTE: No error handling, for brevity (see getting started)

FLString json = FLSTR("{\"id\":\"1002\",\"type\":\"hotel\",\"name\":\"Hotel Ned\",\"city\":\"Balmain\",\"country\":\"Australia\"}");

// Create a dictionary from the JSON string
FLError err;
FLSliceResult jsonData1 = FLData_ConvertJSON(json, &amp;err);
FLDict hotel = FLValue_AsDict(FLValue_FromData(FLSliceResult_AsSlice(jsonData1), kFLTrusted));

// Iterate through the dictionary
FLDictIterator iter;
FLDictIterator_Begin(hotel, &amp;iter);
FLValue value;
while (NULL != (value = FLDictIterator_GetValue(&amp;iter))) {
    FLString key = FLDictIterator_GetKeyString(&amp;iter);
    FLString strValue = FLValue_AsString(value);
    printf("%.<strong>s :: %.*s\n", (int)key.size, (const char</strong>)key.buf, (int)strValue.size, (const char*)strValue.buf);
    FLDictIterator_Next(&amp;iter);
}

// Convert the dictionary to JSON
FLSliceResult jsonData2 = FLValue_ToJSON((FLValue)hotel);
printf("Hotel in JSON :: %.*s\n", (int)jsonData2.size, (const char *)jsonData2.buf);

// Release JSON data after finish using it
FLSliceResult_Release(jsonData1);
FLSliceResult_Release(jsonData2);</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the dictionary using a JSON string</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-document"><a class="anchor" href="#lbl-document"></a>Documents</h3>
<div class="paragraph">
<p>Convert a <code>Document</code> to and from JSON strings using the <code>toJSON()</code> and <code>setJSON()</code> methods&#8201;&#8212;&#8201;see <a href="#ex-document">Example 13</a>.</p>
</div>
<div class="paragraph">
<p>Additionally you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialize a 'MutableDocument' using data supplied as a JSON string.
This is done using the <code>init(json)</code> and-or <code>init(id: json:)</code> constructor-- see: <a href="#ex-document">Example 13</a></p>
</li>
<li>
<p>Set data with a JSON string using <code>setJSON()</code></p>
</li>
</ul>
</div>
<div id="ex-document" class="exampleblock">
<div class="title">Example 13. Documents as JSON strings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// NOTE: No error handling, for brevity (see getting started)

FLString json = FLSTR("{\"id\":\"1002\",\"type\":\"hotel\",\"name\":\"Hotel Ned\",\"city\":\"Balmain\",\"country\":\"Australia\"}");

// Create a document and set the JSON data to the document
CBLError err;
CBLDocument* newDoc = CBLDocument_CreateWithID(FLSTR("hotel_1002"));
CBLDocument_SetJSON(newDoc, json, &amp;err);

// Save the document to the database
CBLDatabase_SaveDocument(db, newDoc, &amp;err);

// Release created doc after using it
CBLDocument_Release(newDoc);

// Get the document from the database
const CBLDocument* doc = CBLDatabase_GetDocument(db, FLSTR("hotel_1002"), &amp;err);

// Get document body as JSON
FLSliceResult docJson = CBLDocument_CreateJSON(doc);
printf("Document in JSON :: %.*s\n", (int)docJson.size, (const char *)docJson.buf);

// Release JSON data after using it
FLSliceResult_Release(docJson);

// Release doc read from the database after using it
CBLDocument_Release(doc);</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get a document as a JSON string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Initialize a MutableDocument using the JSON string and save to a separate database</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Retrieve the document created from JSON and print values</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-result"><a class="anchor" href="#lbl-result"></a>Query Results as JSON</h3>
<div class="paragraph">
<p>Convert a <code>Query Result</code> to JSON using its <code>toJSON()</code> accessor method.</p>
</div>
<div id="ex-json" class="exampleblock">
<div class="title">Example 14. Using JSON Results</div>
<div class="content">
<div class="paragraph">
<p>Use <a href="http://docs.couchbase.com/mobile/3.0.2/couchbase-lite-c/C/html/group__json.html#ga3450acc0690101545d75986b91e4080">FLValue_ToJSON()</a> to transform your result string into a JSON string, which can easily be serialized or used as required in your application. See <<ex-json>> for a working example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="file:///Users/hakimcassimally/couchbase/docs-couchbase-lite/modules/c/examples/code_snippets/main.c">// NOTE: No error handling, for brevity (see getting started)

CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
while(CBLResultSet_Next(results)) {
    FLDict result = CBLResultSet_ResultDict(results);
    FLStringResult json = FLValue_ToJSON((FLValue)result);
    printf("JSON Result :: %.*s\n", (int)json.size, (const char *)json.buf);
    FLSliceResult_Release(json);
}
CBLResultSet_Release(results);</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the Query result as a JSON string&#8201;&#8212;&#8201;see <a href="#ex-json-format">JSON String Format</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get a native object from the JSON string</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Populate your custom object from the dictionary created from JSON data</td>
</tr>
</table>
</div>
<div id="ex-json-format" class="paragraph">
<div class="title">JSON String Format</div>
<p>If your query selects ALL then the JSON format will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
  database-name: {
    key1: "value1",
    keyx: "valuex"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your query selects a sub-set of available properties then the JSON format will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
  key1: "value1",
  keyx: "valuex"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id=""><a class="anchor" href="#"></a></h6>
<div class="ulist">
<div class="title">How to . . .</div>
<ul>
<li>
<p><a href="gs-prereqs.html" class="xref page">Prerequisites</a></p>
</li>
<li>
<p><a href="gs-install.html" class="xref page">Install</a></p>
</li>
<li>
<p><a href="gs-build.html" class="xref page">Build and Run</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">Learn more . . .</div>
<ul>
<li>
<p><a href="database.html" class="xref page">Databases</a></p>
</li>
<li>
<p><a href="document.html" class="xref page">Documents</a></p>
</li>
<li>
<p><a href="blob.html" class="xref page">Blobs</a></p>
</li>
<li>
<p><a href="replication.html" class="xref page">Remote Sync Gateway</a></p>
</li>
<li>
<p><a href="conflict.html" class="xref page">Handling Data Conflicts</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="paragraph">
<div class="title">Dive Deeper . . .</div>
<p><a href="https://forums.couchbase.com/c/mobile/14">Mobile Forum</a> |
<a href="https://blog.couchbase.com/">Blog</a> |
<a href="https://docs.couchbase.com/tutorials/">Tutorials</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content-2"><a class="anchor" href="#related-content-2"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id="-4"><a class="anchor" href="#-4"></a></h6>
<div class="ulist">
<div class="title">How to . . .</div>
<ul>
<li>
<p><a href="gs-prereqs.html" class="xref page">Prerequisites</a></p>
</li>
<li>
<p><a href="gs-install.html" class="xref page">Install</a></p>
</li>
<li>
<p><a href="gs-build.html" class="xref page">Build and Run</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-5"><a class="anchor" href="#-5"></a></h6>
<div class="ulist">
<div class="title">Learn more . . .</div>
<ul>
<li>
<p><a href="database.html" class="xref page">Databases</a></p>
</li>
<li>
<p><a href="document.html" class="xref page">Documents</a></p>
</li>
<li>
<p><a href="blob.html" class="xref page">Blobs</a></p>
</li>
<li>
<p><a href="replication.html" class="xref page">Remote Sync Gateway</a></p>
</li>
<li>
<p><a href="conflict.html" class="xref page">Handling Data Conflicts</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-6"><a class="anchor" href="#-6"></a></h6>
<div class="paragraph">
<div class="title">Dive Deeper . . .</div>
<p><a href="https://forums.couchbase.com/c/mobile/14">Mobile Forum</a> |
<a href="https://blog.couchbase.com/">Blog</a> |
<a href="https://docs.couchbase.com/tutorials/">Tutorials</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Any change to this reserved key will be detected when it is saved and will result in a Couchbase exception (Error Code 5&#8201;&#8212;&#8201;`CorruptRevisionData`)
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Mobile","components":["couchbase-lite"],"url":"/home/mobile.html","latestVersions":{"couchbase-lite":"3.0"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
